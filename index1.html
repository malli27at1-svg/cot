<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Neue'; color: #000000; color: rgba(0, 0, 0, 0.9); -webkit-text-stroke: rgba(0, 0, 0, 0.9)}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px 'Helvetica Neue'; color: #000000; color: rgba(0, 0, 0, 0.9); -webkit-text-stroke: rgba(0, 0, 0, 0.9); min-height: 16.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1">&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1">&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1">&lt;title&gt;Bloomberg Commodity Index - CFTC COT Analyzer&lt;/title&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://cdn.jsdelivr.net/npm/chart.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;style&gt;</span></p>
<p class="p1"><span class="s1">* {</span></p>
<p class="p1"><span class="s1">margin: 0;</span></p>
<p class="p1"><span class="s1">padding: 0;</span></p>
<p class="p1"><span class="s1">box-sizing: border-box;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">body {</span></p>
<p class="p1"><span class="s1">font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;</span></p>
<p class="p1"><span class="s1">background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);</span></p>
<p class="p1"><span class="s1">min-height: 100vh;</span></p>
<p class="p1"><span class="s1">color: #333;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.container {</span></p>
<p class="p1"><span class="s1">max-width: 1400px;</span></p>
<p class="p1"><span class="s1">margin: 0 auto;</span></p>
<p class="p1"><span class="s1">padding: 20px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">header {</span></p>
<p class="p1"><span class="s1">text-align: center;</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">padding: 40px 20px;</span></p>
<p class="p1"><span class="s1">margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">h1 {</span></p>
<p class="p1"><span class="s1">font-size: 2.5em;</span></p>
<p class="p1"><span class="s1">margin-bottom: 10px;</span></p>
<p class="p1"><span class="s1">text-shadow: 2px 2px 4px rgba(0,0,0,0.3);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.subtitle {</span></p>
<p class="p1"><span class="s1">font-size: 1.2em;</span></p>
<p class="p1"><span class="s1">opacity: 0.9;</span></p>
<p class="p1"><span class="s1">margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.controls {</span></p>
<p class="p1"><span class="s1">background: rgba(255, 255, 255, 0.95);</span></p>
<p class="p1"><span class="s1">padding: 25px;</span></p>
<p class="p1"><span class="s1">border-radius: 15px;</span></p>
<p class="p1"><span class="s1">box-shadow: 0 10px 30px rgba(0,0,0,0.2);</span></p>
<p class="p1"><span class="s1">margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1">gap: 20px;</span></p>
<p class="p1"><span class="s1">align-items: center;</span></p>
<p class="p1"><span class="s1">justify-content: center;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.control-group {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">flex-direction: column;</span></p>
<p class="p1"><span class="s1">gap: 8px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">label {</span></p>
<p class="p1"><span class="s1">font-weight: 600;</span></p>
<p class="p1"><span class="s1">color: #2c3e50;</span></p>
<p class="p1"><span class="s1">font-size: 0.9em;</span></p>
<p class="p1"><span class="s1">text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">letter-spacing: 0.5px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">select, button, input[type="date"] {</span></p>
<p class="p1"><span class="s1">padding: 12px 20px;</span></p>
<p class="p1"><span class="s1">border: 2px solid #e0e0e0;</span></p>
<p class="p1"><span class="s1">border-radius: 8px;</span></p>
<p class="p1"><span class="s1">font-size: 1em;</span></p>
<p class="p1"><span class="s1">transition: all 0.3s ease;</span></p>
<p class="p1"><span class="s1">background: white;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">select:focus, button:focus, input[type="date"]:focus {</span></p>
<p class="p1"><span class="s1">outline: none;</span></p>
<p class="p1"><span class="s1">border-color: #2a5298;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">select:disabled {</span></p>
<p class="p1"><span class="s1">background: #e9ecef;</span></p>
<p class="p1"><span class="s1">cursor: not-allowed;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">button {</span></p>
<p class="p1"><span class="s1">background: #2a5298;</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">border: none;</span></p>
<p class="p1"><span class="s1">cursor: pointer;</span></p>
<p class="p1"><span class="s1">font-weight: 600;</span></p>
<p class="p1"><span class="s1">text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">letter-spacing: 1px;</span></p>
<p class="p1"><span class="s1">margin-top: 20px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">button:hover {</span></p>
<p class="p1"><span class="s1">background: #1e3c72;</span></p>
<p class="p1"><span class="s1">transform: translateY(-2px);</span></p>
<p class="p1"><span class="s1">box-shadow: 0 5px 15px rgba(0,0,0,0.2);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">button:disabled {</span></p>
<p class="p1"><span class="s1">background: #95a5a6;</span></p>
<p class="p1"><span class="s1">cursor: not-allowed;</span></p>
<p class="p1"><span class="s1">transform: none;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.chart-section {</span></p>
<p class="p1"><span class="s1">background: white;</span></p>
<p class="p1"><span class="s1">padding: 30px;</span></p>
<p class="p1"><span class="s1">border-radius: 15px;</span></p>
<p class="p1"><span class="s1">box-shadow: 0 10px 30px rgba(0,0,0,0.2);</span></p>
<p class="p1"><span class="s1">margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.chart-header {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">justify-content: space-between;</span></p>
<p class="p1"><span class="s1">align-items: center;</span></p>
<p class="p1"><span class="s1">margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1">flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1">gap: 15px;</span></p>
<p class="p1"><span class="s1">border-bottom: 2px solid #ecf0f1;</span></p>
<p class="p1"><span class="s1">padding-bottom: 15px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.chart-title {</span></p>
<p class="p1"><span class="s1">font-size: 1.3em;</span></p>
<p class="p1"><span class="s1">font-weight: 700;</span></p>
<p class="p1"><span class="s1">color: #2c3e50;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.chart-controls {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">gap: 15px;</span></p>
<p class="p1"><span class="s1">align-items: center;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.chart-container {</span></p>
<p class="p1"><span class="s1">position: relative;</span></p>
<p class="p1"><span class="s1">height: 400px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stats-grid {</span></p>
<p class="p1"><span class="s1">display: grid;</span></p>
<p class="p1"><span class="s1">grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));</span></p>
<p class="p1"><span class="s1">gap: 15px;</span></p>
<p class="p1"><span class="s1">margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stat-card {</span></p>
<p class="p1"><span class="s1">background: white;</span></p>
<p class="p1"><span class="s1">padding: 20px;</span></p>
<p class="p1"><span class="s1">border-radius: 12px;</span></p>
<p class="p1"><span class="s1">box-shadow: 0 5px 15px rgba(0,0,0,0.1);</span></p>
<p class="p1"><span class="s1">border-left: 5px solid #2a5298;</span></p>
<p class="p1"><span class="s1">transition: transform 0.3s ease;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stat-card:hover {</span></p>
<p class="p1"><span class="s1">transform: translateY(-5px);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stat-label {</span></p>
<p class="p1"><span class="s1">font-size: 0.85em;</span></p>
<p class="p1"><span class="s1">color: #7f8c8d;</span></p>
<p class="p1"><span class="s1">text-transform: uppercase;</span></p>
<p class="p1"><span class="s1">letter-spacing: 0.5px;</span></p>
<p class="p1"><span class="s1">margin-bottom: 8px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stat-value {</span></p>
<p class="p1"><span class="s1">font-size: 1.6em;</span></p>
<p class="p1"><span class="s1">font-weight: 700;</span></p>
<p class="p1"><span class="s1">color: #2c3e50;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stat-sub {</span></p>
<p class="p1"><span class="s1">font-size: 0.85em;</span></p>
<p class="p1"><span class="s1">color: #95a5a6;</span></p>
<p class="p1"><span class="s1">margin-top: 5px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.positive { color: #27ae60; }</span></p>
<p class="p1"><span class="s1">.negative { color: #e74c3c; }</span></p>
<p class="p1"><span class="s1">.neutral { color: #f39c12; }</span></p>
<p class="p1"><span class="s1">.loading {</span></p>
<p class="p1"><span class="s1">display: none;</span></p>
<p class="p1"><span class="s1">text-align: center;</span></p>
<p class="p1"><span class="s1">padding: 40px;</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">font-size: 1.2em;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.spinner {</span></p>
<p class="p1"><span class="s1">border: 4px solid rgba(255,255,255,0.3);</span></p>
<p class="p1"><span class="s1">border-radius: 50%;</span></p>
<p class="p1"><span class="s1">border-top: 4px solid white;</span></p>
<p class="p1"><span class="s1">width: 40px;</span></p>
<p class="p1"><span class="s1">height: 40px;</span></p>
<p class="p1"><span class="s1">animation: spin 1s linear infinite;</span></p>
<p class="p1"><span class="s1">margin: 0 auto 20px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">@keyframes spin {</span></p>
<p class="p1"><span class="s1">0% { transform: rotate(0deg); }</span></p>
<p class="p1"><span class="s1">100% { transform: rotate(360deg); }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.error {</span></p>
<p class="p1"><span class="s1">background: #e74c3c;</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">padding: 20px;</span></p>
<p class="p1"><span class="s1">border-radius: 10px;</span></p>
<p class="p1"><span class="s1">margin: 20px 0;</span></p>
<p class="p1"><span class="s1">display: none;</span></p>
<p class="p1"><span class="s1">white-space: pre-wrap;</span></p>
<p class="p1"><span class="s1">font-family: monospace;</span></p>
<p class="p1"><span class="s1">font-size: 0.9em;</span></p>
<p class="p1"><span class="s1">max-height: 400px;</span></p>
<p class="p1"><span class="s1">overflow-y: auto;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.warning {</span></p>
<p class="p1"><span class="s1">background: #f39c12;</span></p>
<p class="p1"><span class="s1">color: #2c3e50;</span></p>
<p class="p1"><span class="s1">padding: 15px;</span></p>
<p class="p1"><span class="s1">border-radius: 8px;</span></p>
<p class="p1"><span class="s1">margin: 10px 0;</span></p>
<p class="p1"><span class="s1">display: none;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.debug-panel {</span></p>
<p class="p1"><span class="s1">background: #2c3e50;</span></p>
<p class="p1"><span class="s1">color: #ecf0f1;</span></p>
<p class="p1"><span class="s1">padding: 20px;</span></p>
<p class="p1"><span class="s1">border-radius: 10px;</span></p>
<p class="p1"><span class="s1">margin: 20px 0;</span></p>
<p class="p1"><span class="s1">display: none;</span></p>
<p class="p1"><span class="s1">font-family: 'Courier New', monospace;</span></p>
<p class="p1"><span class="s1">font-size: 0.85em;</span></p>
<p class="p1"><span class="s1">max-height: 500px;</span></p>
<p class="p1"><span class="s1">overflow-y: auto;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.info-box {</span></p>
<p class="p1"><span class="s1">background: rgba(255,255,255,0.1);</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">padding: 20px;</span></p>
<p class="p1"><span class="s1">border-radius: 10px;</span></p>
<p class="p1"><span class="s1">margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1">border-left: 4px solid rgba(255,255,255,0.5);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.legend-custom {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">justify-content: center;</span></p>
<p class="p1"><span class="s1">gap: 30px;</span></p>
<p class="p1"><span class="s1">margin-top: 20px;</span></p>
<p class="p1"><span class="s1">flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.legend-item {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">align-items: center;</span></p>
<p class="p1"><span class="s1">gap: 8px;</span></p>
<p class="p1"><span class="s1">font-size: 0.9em;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.legend-color {</span></p>
<p class="p1"><span class="s1">width: 20px;</span></p>
<p class="p1"><span class="s1">height: 20px;</span></p>
<p class="p1"><span class="s1">border-radius: 4px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-section {</span></p>
<p class="p1"><span class="s1">background: white;</span></p>
<p class="p1"><span class="s1">padding: 30px;</span></p>
<p class="p1"><span class="s1">border-radius: 15px;</span></p>
<p class="p1"><span class="s1">box-shadow: 0 10px 30px rgba(0,0,0,0.2);</span></p>
<p class="p1"><span class="s1">margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-header {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">justify-content: space-between;</span></p>
<p class="p1"><span class="s1">align-items: center;</span></p>
<p class="p1"><span class="s1">margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1">flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1">gap: 15px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-title {</span></p>
<p class="p1"><span class="s1">font-size: 1.5em;</span></p>
<p class="p1"><span class="s1">font-weight: 700;</span></p>
<p class="p1"><span class="s1">color: #2c3e50;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-controls {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">gap: 10px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-table {</span></p>
<p class="p1"><span class="s1">width: 100%;</span></p>
<p class="p1"><span class="s1">border-collapse: collapse;</span></p>
<p class="p1"><span class="s1">font-size: 0.85em;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-table th {</span></p>
<p class="p1"><span class="s1">background: #2a5298;</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">padding: 10px 8px;</span></p>
<p class="p1"><span class="s1">text-align: center;</span></p>
<p class="p1"><span class="s1">font-weight: 600;</span></p>
<p class="p1"><span class="s1">position: sticky;</span></p>
<p class="p1"><span class="s1">top: 0;</span></p>
<p class="p1"><span class="s1">font-size: 0.9em;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-table td {</span></p>
<p class="p1"><span class="s1">padding: 8px;</span></p>
<p class="p1"><span class="s1">border-bottom: 1px solid #ecf0f1;</span></p>
<p class="p1"><span class="s1">text-align: center;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-table tr:hover {</span></p>
<p class="p1"><span class="s1">background: #f8f9fa;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-table tr:nth-child(even) {</span></p>
<p class="p1"><span class="s1">background: #f8f9fa;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.summary-table tr:nth-child(even):hover {</span></p>
<p class="p1"><span class="s1">background: #e9ecef;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.commodity-name {</span></p>
<p class="p1"><span class="s1">text-align: left !important;</span></p>
<p class="p1"><span class="s1">font-weight: 600;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.section-header {</span></p>
<p class="p1"><span class="s1">background: #34495e !important;</span></p>
<p class="p1"><span class="s1">color: white !important;</span></p>
<p class="p1"><span class="s1">font-weight: 700;</span></p>
<p class="p1"><span class="s1">text-align: left !important;</span></p>
<p class="p1"><span class="s1">padding: 10px !important;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.data-cell {</span></p>
<p class="p1"><span class="s1">font-family: 'Courier New', monospace;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.positive-value {</span></p>
<p class="p1"><span class="s1">color: #27ae60;</span></p>
<p class="p1"><span class="s1">font-weight: 600;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.negative-value {</span></p>
<p class="p1"><span class="s1">color: #e74c3c;</span></p>
<p class="p1"><span class="s1">font-weight: 600;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.table-container {</span></p>
<p class="p1"><span class="s1">max-height: 800px;</span></p>
<p class="p1"><span class="s1">overflow-y: auto;</span></p>
<p class="p1"><span class="s1">border-radius: 8px;</span></p>
<p class="p1"><span class="s1">border: 1px solid #dee2e6;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.stats-legend {</span></p>
<p class="p1"><span class="s1">margin-top: 15px;</span></p>
<p class="p1"><span class="s1">padding: 15px;</span></p>
<p class="p1"><span class="s1">background: #f8f9fa;</span></p>
<p class="p1"><span class="s1">border-radius: 8px;</span></p>
<p class="p1"><span class="s1">font-size: 0.85em;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.range-bar-container {</span></p>
<p class="p1"><span class="s1">width: 100%;</span></p>
<p class="p1"><span class="s1">height: 20px;</span></p>
<p class="p1"><span class="s1">background: #e9ecef;</span></p>
<p class="p1"><span class="s1">border-radius: 10px;</span></p>
<p class="p1"><span class="s1">position: relative;</span></p>
<p class="p1"><span class="s1">margin: 5px 0;</span></p>
<p class="p1"><span class="s1">overflow: hidden;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.range-bar {</span></p>
<p class="p1"><span class="s1">position: absolute;</span></p>
<p class="p1"><span class="s1">height: 100%;</span></p>
<p class="p1"><span class="s1">border-radius: 10px;</span></p>
<p class="p1"><span class="s1">transition: all 0.3s ease;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.range-bar-net-long {</span></p>
<p class="p1"><span class="s1">background: linear-gradient(90deg, #27ae60, #2ecc71);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.range-bar-net-short {</span></p>
<p class="p1"><span class="s1">background: linear-gradient(90deg, #e74c3c, #c0392b);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.range-marker {</span></p>
<p class="p1"><span class="s1">position: absolute;</span></p>
<p class="p1"><span class="s1">width: 4px;</span></p>
<p class="p1"><span class="s1">height: 100%;</span></p>
<p class="p1"><span class="s1">background: #2c3e50;</span></p>
<p class="p1"><span class="s1">border: 2px solid white;</span></p>
<p class="p1"><span class="s1">border-radius: 2px;</span></p>
<p class="p1"><span class="s1">transform: translateX(-50%);</span></p>
<p class="p1"><span class="s1">z-index: 10;</span></p>
<p class="p1"><span class="s1">box-shadow: 0 0 4px rgba(0,0,0,0.3);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.range-labels {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">justify-content: space-between;</span></p>
<p class="p1"><span class="s1">font-size: 0.7em;</span></p>
<p class="p1"><span class="s1">color: #6c757d;</span></p>
<p class="p1"><span class="s1">margin-top: 2px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.seasonality-container {</span></p>
<p class="p1"><span class="s1">background: #f8f9fa;</span></p>
<p class="p1"><span class="s1">padding: 20px;</span></p>
<p class="p1"><span class="s1">border-radius: 8px;</span></p>
<p class="p1"><span class="s1">border: 1px solid #dee2e6;</span></p>
<p class="p1"><span class="s1">margin-top: 20px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.minmax-cell {</span></p>
<p class="p1"><span class="s1">width: 150px;</span></p>
<p class="p1"><span class="s1">padding: 5px !important;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.minmax-bar-container {</span></p>
<p class="p1"><span class="s1">width: 100%;</span></p>
<p class="p1"><span class="s1">height: 30px;</span></p>
<p class="p1"><span class="s1">background: #e9ecef;</span></p>
<p class="p1"><span class="s1">border-radius: 4px;</span></p>
<p class="p1"><span class="s1">position: relative;</span></p>
<p class="p1"><span class="s1">overflow: hidden;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.minmax-bar-bg {</span></p>
<p class="p1"><span class="s1">position: absolute;</span></p>
<p class="p1"><span class="s1">width: 100%;</span></p>
<p class="p1"><span class="s1">height: 100%;</span></p>
<p class="p1"><span class="s1">background: linear-gradient(90deg, rgba(231,76,60,0.2) 0%, rgba(255,255,255,0) 50%, rgba(39,174,96,0.2) 100%);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.minmax-current {</span></p>
<p class="p1"><span class="s1">position: absolute;</span></p>
<p class="p1"><span class="s1">width: 12px;</span></p>
<p class="p1"><span class="s1">height: 12px;</span></p>
<p class="p1"><span class="s1">background: #2c3e50;</span></p>
<p class="p1"><span class="s1">border: 2px solid white;</span></p>
<p class="p1"><span class="s1">border-radius: 50%;</span></p>
<p class="p1"><span class="s1">top: 50%;</span></p>
<p class="p1"><span class="s1">transform: translate(-50%, -50%);</span></p>
<p class="p1"><span class="s1">z-index: 10;</span></p>
<p class="p1"><span class="s1">box-shadow: 0 0 4px rgba(0,0,0,0.5);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.minmax-labels {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">justify-content: space-between;</span></p>
<p class="p1"><span class="s1">font-size: 0.65em;</span></p>
<p class="p1"><span class="s1">color: #6c757d;</span></p>
<p class="p1"><span class="s1">margin-top: 2px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.year-selector {</span></p>
<p class="p1"><span class="s1">display: flex;</span></p>
<p class="p1"><span class="s1">flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1">gap: 8px;</span></p>
<p class="p1"><span class="s1">margin-bottom: 15px;</span></p>
<p class="p1"><span class="s1">padding: 10px;</span></p>
<p class="p1"><span class="s1">background: #f8f9fa;</span></p>
<p class="p1"><span class="s1">border-radius: 8px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.year-chip {</span></p>
<p class="p1"><span class="s1">padding: 5px 12px;</span></p>
<p class="p1"><span class="s1">border: 2px solid #dee2e6;</span></p>
<p class="p1"><span class="s1">border-radius: 20px;</span></p>
<p class="p1"><span class="s1">cursor: pointer;</span></p>
<p class="p1"><span class="s1">font-size: 0.85em;</span></p>
<p class="p1"><span class="s1">transition: all 0.2s;</span></p>
<p class="p1"><span class="s1">background: white;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.year-chip:hover {</span></p>
<p class="p1"><span class="s1">border-color: #2a5298;</span></p>
<p class="p1"><span class="s1">background: #e3f2fd;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">.year-chip.active {</span></p>
<p class="p1"><span class="s1">background: #2a5298;</span></p>
<p class="p1"><span class="s1">color: white;</span></p>
<p class="p1"><span class="s1">border-color: #2a5298;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">#commoditySelect {</span></p>
<p class="p1"><span class="s1">min-width: 300px;</span></p>
<p class="p1"><span class="s1">cursor: pointer;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">#commoditySelect option {</span></p>
<p class="p1"><span class="s1">padding: 10px;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">@media (max-width: 768px) {</span></p>
<p class="p1"><span class="s1">h1 { font-size: 1.8em; }</span></p>
<p class="p1"><span class="s1">.controls { flex-direction: column; }</span></p>
<p class="p1"><span class="s1">.chart-header { flex-direction: column; align-items: flex-start; }</span></p>
<p class="p1"><span class="s1">.chart-controls { width: 100%; }</span></p>
<p class="p1"><span class="s1">.chart-container { height: 300px; }</span></p>
<p class="p1"><span class="s1">.summary-table { font-size: 0.75em; }</span></p>
<p class="p1"><span class="s1">.summary-table th, .summary-table td { padding: 6px 4px; }</span></p>
<p class="p1"><span class="s1">.minmax-cell { width: 100px; }</span></p>
<p class="p1"><span class="s1">#commoditySelect { min-width: 100%; }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;base target="_blank"&gt;</span></p>
<p class="p1"><span class="s1">&lt;base target="_blank"&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="container"&gt;</span></p>
<p class="p1"><span class="s1">&lt;header&gt;</span></p>
<p class="p1"><span class="s1">&lt;h1&gt;üìä Bloomberg Commodity Index COT Analyzer&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="subtitle"&gt;CFTC Commitment of Traders - BCOM Constituents Only&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="info-box"&gt;</span></p>
<p class="p1"><span class="s1">&lt;strong&gt;Data Source:&lt;/strong&gt; U.S. Commodity Futures Trading Commission (CFTC) Disaggregated Reports&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;strong&gt;Index:&lt;/strong&gt; Bloomberg Commodity Index (BCOM) 2026 Target Weights&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;strong&gt;Coverage:&lt;/strong&gt; 23 commodities across Energy, Grains, Industrial Metals, Precious Metals, Softs, Livestock&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;strong&gt;Update Frequency:&lt;/strong&gt; Weekly (Every Friday at 3:30 PM ET)&lt;br&gt;</span></p>
<p class="p1"><span class="s1">&lt;strong&gt;‚úÖ FIXED:&lt;/strong&gt; Silver data mapping &amp; Weekly Seasonality Charts</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/header&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="controls"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="control-group"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label for="commoditySelect"&gt;Select Commodity (BCOM Only)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="commoditySelect"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value=""&gt;-- Loading Commodities... --&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="control-group"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label for="traderCategory"&gt;Trader Category&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="traderCategory"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="managed_money" selected&gt;Managed Money&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="swap_dealers"&gt;Swap Dealers&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="prod_merc"&gt;Producer/Merchant/Processor/User&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="other_rept"&gt;Other Reportables&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="control-group"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label for="reportType"&gt;Report Type&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="reportType"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="futures"&gt;Futures Only (72hh-3qpy)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="combined" selected&gt;Futures &amp; Options Combined (kh3c-gbw2)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="control-group"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;Start Date&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;input type="date" id="startDate" value="2006-01-01"&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="control-group"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;End Date&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;input type="date" id="endDate"&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;button id="fetchBtn" onclick="fetchData()"&gt;üìà Generate Charts&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button id="summaryBtn" onclick="generateSummary()" style="background:#27ae60; margin-left:10px;"&gt;üìã Market Summary&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button id="downloadBtn" onclick="downloadCSV()" style="background:#8e44ad; margin-left:10px;"&gt;‚¨áÔ∏è Download CSV&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button id="debugBtn" onclick="toggleDebug()" style="background:#e67e22; margin-left:10px;"&gt;üîç Debug&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="loading" id="loading"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="spinner"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="loadingText"&gt;Fetching CFTC data...&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="error" id="error"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="warning" id="warning"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="debug-panel" id="debugPanel"&gt;</span></p>
<p class="p1"><span class="s1">&lt;h3&gt;API Response Debugger&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="debugContent"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="summary-section" id="summarySection" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="summary-header"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="summary-title"&gt;üìã BCOM Weekly Market Summary - All Trader Categories (Historical Context Since 2006)&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="summary-controls"&gt;</span></p>
<p class="p1"><span class="s1">&lt;button onclick="refreshSummary()" style="margin-top:0; padding:8px 15px; font-size:0.9em;"&gt;üîÑ Refresh All&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="table-container"&gt;</span></p>
<p class="p1"><span class="s1">&lt;table class="summary-table" id="summaryTable"&gt;</span></p>
<p class="p1"><span class="s1">&lt;thead&gt;</span></p>
<p class="p1"><span class="s1">&lt;tr&gt;</span></p>
<p class="p1"><span class="s1">&lt;th rowspan="2"&gt;Commodity&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th rowspan="2"&gt;Trader Category&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th colspan="2"&gt;Net Position (Contracts)&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th colspan="2"&gt;Net % of OI&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th colspan="2"&gt;Long Position (Contracts)&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th colspan="2"&gt;Long % of OI&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th colspan="2"&gt;Short Position (Contracts)&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th colspan="2"&gt;Short % of OI&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1">&lt;tr&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Visual Range&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Current&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Visual Range&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Current&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Visual Range&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Current&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Visual Range&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Current&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Visual Range&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Current&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Visual Range&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;th&gt;Current&lt;/th&gt;</span></p>
<p class="p1"><span class="s1">&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1">&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1">&lt;tbody id="summaryTableBody"&gt;</span></p>
<p class="p1"><span class="s1">&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1">&lt;/table&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stats-legend"&gt;</span></p>
<p class="p1"><span class="s1">&lt;strong&gt;Visual Range Guide:&lt;/strong&gt; Bars show historical min (left) to max (right). Dot shows current position. Green = positive/long, Red = negative/short.</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stats-grid" id="statsGrid" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Current Net Position&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value" id="currentNet"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub" id="currentNetPct"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="range-bar-container" id="netRangeBar" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="range-bar range-bar-net-long" style="width: 100%;"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="range-marker" style="left: 50%;"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="range-labels" id="netRangeLabels" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;span id="netMinLabel"&gt;Min&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;span&gt;Current&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;span id="netMaxLabel"&gt;Max&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Long Positions&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value positive" id="currentLong"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub" id="currentLongPct"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Short Positions&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value negative" id="currentShort"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub" id="currentShortPct"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Number of Traders&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value neutral" id="numTraders"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub"&gt;Long: &lt;span id="tradersLong"&gt;--&lt;/span&gt; | Short: &lt;span id="tradersShort"&gt;--&lt;/span&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Position per Trader (Long)&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value" id="posPerTraderLong"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub"&gt;Gross Long / Long Traders&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Position per Trader (Short)&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value" id="posPerTraderShort"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub"&gt;Gross Short / Short Traders&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Open Interest&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value" id="openInterest"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub"&gt;Total market OI&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-card"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;Weekly Change&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value" id="weeklyChange"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub" id="weeklyChangePct"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-section" id="chart1" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-header"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-title"&gt;üìä Position Analysis&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-controls"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;Select Metric:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="positionMetric" onchange="updatePositionChart()"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="net"&gt;Net Position (Long - Short)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="long"&gt;Long Positions&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="short"&gt;Short Positions&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="spread"&gt;Spreading Positions&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="net_pct"&gt;Net as % of OI&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="long_pct"&gt;Long as % of OI&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="short_pct"&gt;Short as % of OI&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-container"&gt;</span></p>
<p class="p1"><span class="s1">&lt;canvas id="positionChart"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="legend-custom" id="positionLegend"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="legend-item"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="legend-color" style="background:rgba(42, 82, 152, 0.8)"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;span&gt;Position&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="legend-item"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="legend-color" style="background:rgba(231, 76, 60, 0.3)"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;span&gt;Zero Line&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-section" id="chart2" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-header"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-title"&gt;üë• Trader Count Analysis&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-controls"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;Select Metric:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="traderMetric" onchange="updateTraderChart()"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="total"&gt;Total Traders&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="long"&gt;Long Traders&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="short"&gt;Short Traders&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="both"&gt;Long &amp; Short (Combined)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-container"&gt;</span></p>
<p class="p1"><span class="s1">&lt;canvas id="traderChart"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-section" id="chart3" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-header"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-title"&gt;‚öñÔ∏è Position Size Analysis&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-controls"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;Select Metric:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="sizeMetric" onchange="updateSizeChart()"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="per_trader_long"&gt;Contracts per Trader (Long)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="per_trader_short"&gt;Contracts per Trader (Short)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="long_vs_short"&gt;Long vs Short per Trader&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-container"&gt;</span></p>
<p class="p1"><span class="s1">&lt;canvas id="sizeChart"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-section" id="chart4" style="display:none;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-header"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-title"&gt;üìÖ Weekly Seasonality Analysis (52-Week Pattern)&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-controls"&gt;</span></p>
<p class="p1"><span class="s1">&lt;label&gt;Select Parameter:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1">&lt;select id="seasonalityMetric" onchange="updateSeasonalityChart()"&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="net"&gt;Net Position&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="long"&gt;Long Positions&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="short"&gt;Short Positions&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="net_pct"&gt;Net % of OI&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="traders_total"&gt;Total Traders&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="per_trader_long"&gt;Contracts per Trader (Long)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;option value="per_trader_short"&gt;Contracts per Trader (Short)&lt;/option&gt;</span></p>
<p class="p1"><span class="s1">&lt;/select&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="year-selector" id="yearSelector"&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="seasonality-container"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chart-container" style="height: 500px;"&gt;</span></p>
<p class="p1"><span class="s1">&lt;canvas id="seasonalityChart"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1">// CFTC Socrata API endpoints</span></p>
<p class="p1"><span class="s1">const ENDPOINTS = {</span></p>
<p class="p1"><span class="s1">futures: 'https://publicreporting.cftc.gov/resource/72hh-3qpy.json',</span></p>
<p class="p1"><span class="s1">combined: 'https://publicreporting.cftc.gov/resource/kh3c-gbw2.json'</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Bloomberg Commodity Index 2026 Constituents - EXACT CFTC API Names</span></p>
<p class="p1"><span class="s1">// FIXED: Silver now uses exact CFTC name "SILVER - COMMODITY EXCHANGE INC."</span></p>
<p class="p1"><span class="s1">const BCOM_COMMODITIES = {</span></p>
<p class="p1"><span class="s1">'Energy (29.44%)': [</span></p>
<p class="p1"><span class="s1">{ name: 'Brent Crude Oil', ticker: 'CO', cftc_name: 'BRENT CRUDE OIL LAST DAY - NEW YORK MERCANTILE EXCHANGE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Natural Gas', ticker: 'NG', cftc_name: 'NATURAL GAS - NEW YORK MERCANTILE EXCHANGE' },</span></p>
<p class="p1"><span class="s1">{ name: 'WTI Crude Oil', ticker: 'CL', cftc_name: 'CRUDE OIL, LIGHT SWEET - NEW YORK MERCANTILE EXCHANGE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Low Sulphur Gas Oil', ticker: 'QS', cftc_name: 'GAS OIL LOW SULPHUR - ICE FUTURES EUROPE' },</span></p>
<p class="p1"><span class="s1">{ name: 'ULS Diesel', ticker: 'HO', cftc_name: 'NY HARBOR ULSD - NEW YORK MERCANTILE EXCHANGE' },</span></p>
<p class="p1"><span class="s1">{ name: 'RBOB Gasoline', ticker: 'XB', cftc_name: 'GASOLINE, RBOB - NEW YORK MERCANTILE EXCHANGE' }</span></p>
<p class="p1"><span class="s1">],</span></p>
<p class="p1"><span class="s1">'Grains (21.15%)': [</span></p>
<p class="p1"><span class="s1">{ name: 'Corn', ticker: 'C', cftc_name: 'CORN - CHICAGO BOARD OF TRADE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Soybeans', ticker: 'S', cftc_name: 'SOYBEANS - CHICAGO BOARD OF TRADE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Soybean Meal', ticker: 'SM', cftc_name: 'SOYBEAN MEAL - CHICAGO BOARD OF TRADE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Soybean Oil', ticker: 'BO', cftc_name: 'SOYBEAN OIL - CHICAGO BOARD OF TRADE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Wheat', ticker: 'W', cftc_name: 'WHEAT-SRW - CHICAGO BOARD OF TRADE' },</span></p>
<p class="p1"><span class="s1">{ name: 'HRW Wheat', ticker: 'KW', cftc_name: 'WHEAT-HRW - CHICAGO BOARD OF TRADE' }</span></p>
<p class="p1"><span class="s1">],</span></p>
<p class="p1"><span class="s1">'Industrial Metals (15.76%)': [</span></p>
<p class="p1"><span class="s1">{ name: 'Copper', ticker: 'HG', cftc_name: 'COPPER- #1 - COMMODITY EXCHANGE INC.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Aluminum', ticker: 'LA', cftc_name: 'ALUMINUM - COMMODITY EXCHANGE INC.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Zinc', ticker: 'LX', cftc_name: 'ZINC - COMMODITY EXCHANGE INC.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Nickel', ticker: 'LN', cftc_name: 'NICKEL - COMMODITY EXCHANGE INC.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Lead', ticker: 'LL', cftc_name: 'LEAD - COMMODITY EXCHANGE INC.' }</span></p>
<p class="p1"><span class="s1">],</span></p>
<p class="p1"><span class="s1">'Precious Metals (18.84%)': [</span></p>
<p class="p1"><span class="s1">{ name: 'Gold', ticker: 'GC', cftc_name: 'GOLD - COMMODITY EXCHANGE INC.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Silver', ticker: 'SI', cftc_name: 'SILVER - COMMODITY EXCHANGE INC.' }</span></p>
<p class="p1"><span class="s1">],</span></p>
<p class="p1"><span class="s1">'Softs (9.12%)': [</span></p>
<p class="p1"><span class="s1">{ name: 'Sugar', ticker: 'SB', cftc_name: 'SUGAR NO. 11 - ICE FUTURES U.S.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Coffee', ticker: 'KC', cftc_name: 'COFFEE C - ICE FUTURES U.S.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Cocoa', ticker: 'CC', cftc_name: 'COCOA - ICE FUTURES U.S.' },</span></p>
<p class="p1"><span class="s1">{ name: 'Cotton', ticker: 'CT', cftc_name: 'COTTON NO. 2 - ICE FUTURES U.S.' }</span></p>
<p class="p1"><span class="s1">],</span></p>
<p class="p1"><span class="s1">'Livestock (5.64%)': [</span></p>
<p class="p1"><span class="s1">{ name: 'Live Cattle', ticker: 'LC', cftc_name: 'LIVE CATTLE - CHICAGO MERCANTILE EXCHANGE' },</span></p>
<p class="p1"><span class="s1">{ name: 'Lean Hogs', ticker: 'LH', cftc_name: 'LEAN HOGS - CHICAGO MERCANTILE EXCHANGE' }</span></p>
<p class="p1"><span class="s1">]</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// CORRECTED Field mappings based on CFTC API documentation</span></p>
<p class="p1"><span class="s1">// Using exact field names from kh3c-gbw2 dataset</span></p>
<p class="p1"><span class="s1">const TRADER_FIELDS = {</span></p>
<p class="p1"><span class="s1">managed_money: {</span></p>
<p class="p1"><span class="s1">long: ['m_money_positions_long_all', 'm_money_positions_long'],</span></p>
<p class="p1"><span class="s1">short: ['m_money_positions_short_all', 'm_money_positions_short'],</span></p>
<p class="p1"><span class="s1">spread: ['m_money_positions_spread_all', 'm_money_positions_spread'],</span></p>
<p class="p1"><span class="s1">traders_long: ['traders_m_money_long_all', 'traders_m_money_long'],</span></p>
<p class="p1"><span class="s1">traders_short: ['traders_m_money_short_all', 'traders_m_money_short']</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">swap_dealers: {</span></p>
<p class="p1"><span class="s1">// Using exact field names from CFTC combined report</span></p>
<p class="p1"><span class="s1">long: ['swap_positions_long_all', 'swap__positions_long_all', 'swap_dealer_positions_long_all'],</span></p>
<p class="p1"><span class="s1">short: ['swap__positions_short_all', 'swap_positions_short_all', 'swap_dealer_positions_short_all'],</span></p>
<p class="p1"><span class="s1">spread: ['swap__positions_spread_all', 'swap_positions_spread_all', 'swap_dealer_positions_spread_all'],</span></p>
<p class="p1"><span class="s1">traders_long: ['traders_swap_long_all', 'traders_swap_dealer_long_all'],</span></p>
<p class="p1"><span class="s1">traders_short: ['traders_swap_short_all', 'traders_swap_dealer_short_all']</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">prod_merc: {</span></p>
<p class="p1"><span class="s1">long: ['prod_merc_positions_long_all', 'prod_merc_positions_long'],</span></p>
<p class="p1"><span class="s1">short: ['prod_merc_positions_short_all', 'prod_merc_positions_short'],</span></p>
<p class="p1"><span class="s1">spread: ['prod_merc_positions_spread_all', 'prod_merc_positions_spread'],</span></p>
<p class="p1"><span class="s1">traders_long: ['traders_prod_merc_long_all', 'traders_prod_merc_long'],</span></p>
<p class="p1"><span class="s1">traders_short: ['traders_prod_merc_short_all', 'traders_prod_merc_short']</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">other_rept: {</span></p>
<p class="p1"><span class="s1">long: ['other_rept_positions_long_all', 'other_rept_positions_long'],</span></p>
<p class="p1"><span class="s1">short: ['other_rept_positions_short_all', 'other_rept_positions_short'],</span></p>
<p class="p1"><span class="s1">spread: ['other_rept_positions_spread_all', 'other_rept_positions_spread'],</span></p>
<p class="p1"><span class="s1">traders_long: ['traders_other_rept_long_all', 'traders_other_rept_long'],</span></p>
<p class="p1"><span class="s1">traders_short: ['traders_other_rept_short_all', 'traders_other_rept_short']</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let charts = {</span></p>
<p class="p1"><span class="s1">position: null,</span></p>
<p class="p1"><span class="s1">trader: null,</span></p>
<p class="p1"><span class="s1">size: null,</span></p>
<p class="p1"><span class="s1">seasonality: null</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">let currentData = null;</span></p>
<p class="p1"><span class="s1">let availableCommodities = [];</span></p>
<p class="p1"><span class="s1">let debugInfo = {};</span></p>
<p class="p1"><span class="s1">let summaryData = [];</span></p>
<p class="p1"><span class="s1">let historicalExtremes = {};</span></p>
<p class="p1"><span class="s1">let selectedYears = new Set();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">document.addEventListener('DOMContentLoaded', async () =&gt; {</span></p>
<p class="p1"><span class="s1">document.getElementById('endDate').valueAsDate = new Date();</span></p>
<p class="p1"><span class="s1">document.getElementById('commoditySelect').disabled = false;</span></p>
<p class="p1"><span class="s1">await loadCommodityList();</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function loadCommodityList() {</span></p>
<p class="p1"><span class="s1">const select = document.getElementById('commoditySelect');</span></p>
<p class="p1"><span class="s1">try {</span></p>
<p class="p1"><span class="s1">showLoading(true);</span></p>
<p class="p1"><span class="s1">document.getElementById('loadingText').textContent = 'Loading BCOM commodities...';</span></p>
<p class="p1"><span class="s1">console.log('Loading commodities from API...');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Try to fetch a sample to get available commodities</span></p>
<p class="p1"><span class="s1">const response = await fetchWithTimeout(`${ENDPOINTS.combined}?$limit=5000&amp;$order=report_date_as_yyyy_mm_dd DESC`, 15000);</span></p>
<p class="p1"><span class="s1">if (!response.ok) {</span></p>
<p class="p1"><span class="s1">throw new Error(`HTTP ${response.status}: ${response.statusText}`);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const data = await response.json();</span></p>
<p class="p1"><span class="s1">if (!Array.isArray(data) || data.length === 0) {</span></p>
<p class="p1"><span class="s1">throw new Error('No data received from API');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const apiCommodities = [...new Set(data.map(d =&gt; d.market_and_exchange_names))].filter(c =&gt; c).sort();</span></p>
<p class="p1"><span class="s1">availableCommodities = apiCommodities;</span></p>
<p class="p1"><span class="s1">console.log('Available commodities:', apiCommodities.length);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Clear and rebuild select options</span></p>
<p class="p1"><span class="s1">select.innerHTML = '&lt;option value=""&gt;-- Select a BCOM Commodity --&lt;/option&gt;';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">Object.entries(BCOM_COMMODITIES).forEach(([sector, commodities]) =&gt; {</span></p>
<p class="p1"><span class="s1">const optgroup = document.createElement('optgroup');</span></p>
<p class="p1"><span class="s1">optgroup.label = sector;</span></p>
<p class="p1"><span class="s1">let hasAvailable = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">commodities.forEach(comm =&gt; {</span></p>
<p class="p1"><span class="s1">// Try exact match first, then partial match</span></p>
<p class="p1"><span class="s1">let match = apiCommodities.find(c =&gt; c &amp;&amp; c.toUpperCase() === comm.cftc_name.toUpperCase());</span></p>
<p class="p1"><span class="s1">if (!match) {</span></p>
<p class="p1"><span class="s1">// Try partial match on the main name part (before " - ")</span></p>
<p class="p1"><span class="s1">const namePart = comm.cftc_name.split(' - ')[0].toUpperCase();</span></p>
<p class="p1"><span class="s1">match = apiCommodities.find(c =&gt; {</span></p>
<p class="p1"><span class="s1">if (!c) return false;</span></p>
<p class="p1"><span class="s1">const cParts = c.split(' - ');</span></p>
<p class="p1"><span class="s1">return cParts[0].toUpperCase().includes(namePart) || namePart.includes(cParts[0].toUpperCase());</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if (match) {</span></p>
<p class="p1"><span class="s1">const option = document.createElement('option');</span></p>
<p class="p1"><span class="s1">option.value = match;</span></p>
<p class="p1"><span class="s1">option.textContent = `${comm.name} (${comm.ticker}) - ${match}`;</span></p>
<p class="p1"><span class="s1">option.dataset.ticker = comm.ticker;</span></p>
<p class="p1"><span class="s1">option.dataset.sector = sector;</span></p>
<p class="p1"><span class="s1">optgroup.appendChild(option);</span></p>
<p class="p1"><span class="s1">hasAvailable = true;</span></p>
<p class="p1"><span class="s1">console.log('Added commodity:', comm.name, '-&gt;', match);</span></p>
<p class="p1"><span class="s1">} else {</span></p>
<p class="p1"><span class="s1">console.warn('No match found for:', comm.cftc_name);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if (hasAvailable) {</span></p>
<p class="p1"><span class="s1">select.appendChild(optgroup);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Ensure select is enabled after loading</span></p>
<p class="p1"><span class="s1">select.disabled = false;</span></p>
<p class="p1"><span class="s1">console.log('Commodity select loaded with', select.options.length - 1, 'options');</span></p>
<p class="p1"><span class="s1">showLoading(false);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">} catch (error) {</span></p>
<p class="p1"><span class="s1">console.error('Load error:', error);</span></p>
<p class="p1"><span class="s1">showLoading(false);</span></p>
<p class="p1"><span class="s1">// Add fallback options if API fails</span></p>
<p class="p1"><span class="s1">select.innerHTML = '&lt;option value=""&gt;-- Select a Commodity --&lt;/option&gt;';</span></p>
<p class="p1"><span class="s1">Object.entries(BCOM_COMMODITIES).forEach(([sector, commodities]) =&gt; {</span></p>
<p class="p1"><span class="s1">const optgroup = document.createElement('optgroup');</span></p>
<p class="p1"><span class="s1">optgroup.label = sector;</span></p>
<p class="p1"><span class="s1">commodities.forEach(comm =&gt; {</span></p>
<p class="p1"><span class="s1">const option = document.createElement('option');</span></p>
<p class="p1"><span class="s1">option.value = comm.cftc_name;</span></p>
<p class="p1"><span class="s1">option.textContent = `${comm.name} (${comm.ticker})`;</span></p>
<p class="p1"><span class="s1">optgroup.appendChild(option);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">select.appendChild(optgroup);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">select.disabled = false;</span></p>
<p class="p1"><span class="s1">showError(`Failed to load commodity list from API: ${error.message}. Using fallback list.`);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function fetchWithTimeout(url, timeout = 10000) {</span></p>
<p class="p1"><span class="s1">const controller = new AbortController();</span></p>
<p class="p1"><span class="s1">const id = setTimeout(() =&gt; controller.abort(), timeout);</span></p>
<p class="p1"><span class="s1">try {</span></p>
<p class="p1"><span class="s1">const response = await fetch(url, { signal: controller.signal });</span></p>
<p class="p1"><span class="s1">clearTimeout(id);</span></p>
<p class="p1"><span class="s1">return response;</span></p>
<p class="p1"><span class="s1">} catch (error) {</span></p>
<p class="p1"><span class="s1">clearTimeout(id);</span></p>
<p class="p1"><span class="s1">if (error.name === 'AbortError') {</span></p>
<p class="p1"><span class="s1">throw new Error('Request timeout - API took too long to respond');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">throw error;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function toggleDebug() {</span></p>
<p class="p1"><span class="s1">const panel = document.getElementById('debugPanel');</span></p>
<p class="p1"><span class="s1">if (panel.style.display === 'none') {</span></p>
<p class="p1"><span class="s1">panel.style.display = 'block';</span></p>
<p class="p1"><span class="s1">updateDebugPanel();</span></p>
<p class="p1"><span class="s1">} else {</span></p>
<p class="p1"><span class="s1">panel.style.display = 'none';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateDebugPanel() {</span></p>
<p class="p1"><span class="s1">const content = document.getElementById('debugContent');</span></p>
<p class="p1"><span class="s1">if (!debugInfo.lastResponse) {</span></p>
<p class="p1"><span class="s1">content.innerHTML = '&lt;p&gt;No data fetched yet. Click "Generate Charts" first.&lt;/p&gt;';</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">let html = '&lt;h4&gt;Last API Call:&lt;/h4&gt;';</span></p>
<p class="p1"><span class="s1">html += `&lt;p&gt;&lt;strong&gt;URL:&lt;/strong&gt; ${debugInfo.lastUrl || 'N/A'}&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1">html += `&lt;p&gt;&lt;strong&gt;Records received:&lt;/strong&gt; ${debugInfo.recordCount || 0}&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1">html += `&lt;p&gt;&lt;strong&gt;Commodity:&lt;/strong&gt; ${debugInfo.commodity || 'N/A'}&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1">html += `&lt;p&gt;&lt;strong&gt;Trader Category:&lt;/strong&gt; ${debugInfo.traderCategory || 'N/A'}&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1">if (debugInfo.sampleRecord) {</span></p>
<p class="p1"><span class="s1">html += '&lt;h4&gt;Sample Record Fields:&lt;/h4&gt;&lt;div style="background:#1a252f; padding:10px; border-radius:5px; max-height:300px; overflow-y:auto;"&gt;';</span></p>
<p class="p1"><span class="s1">html += '&lt;pre style="margin:0; font-size:0.8em;"&gt;';</span></p>
<p class="p1"><span class="s1">const fields = Object.keys(debugInfo.sampleRecord).sort();</span></p>
<p class="p1"><span class="s1">fields.forEach(f =&gt; {</span></p>
<p class="p1"><span class="s1">const val = debugInfo.sampleRecord[f];</span></p>
<p class="p1"><span class="s1">const preview = val !== null ? String(val).substring(0, 50) : 'null';</span></p>
<p class="p1"><span class="s1">html += `${f}: ${preview}\n`;</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">html += '&lt;/pre&gt;&lt;/div&gt;';</span></p>
<p class="p1"><span class="s1">if (debugInfo.detectedFields) {</span></p>
<p class="p1"><span class="s1">html += '&lt;h4&gt;‚úÖ Detected Fields:&lt;/h4&gt;&lt;ul&gt;';</span></p>
<p class="p1"><span class="s1">Object.entries(debugInfo.detectedFields).forEach(([key, value]) =&gt; {</span></p>
<p class="p1"><span class="s1">const status = value ? '‚úÖ' : '‚ùå';</span></p>
<p class="p1"><span class="s1">html += `&lt;li&gt;&lt;strong&gt;${key}:&lt;/strong&gt; ${status} ${value || 'NOT FOUND'}&lt;/li&gt;`;</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">html += '&lt;/ul&gt;';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if (debugInfo.error) {</span></p>
<p class="p1"><span class="s1">html += `&lt;h4 style="color:#e74c3c;"&gt;Error:&lt;/h4&gt;&lt;p&gt;${debugInfo.error}&lt;/p&gt;`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">content.innerHTML = html;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function generateSummary() {</span></p>
<p class="p1"><span class="s1">const reportType = document.getElementById('reportType').value;</span></p>
<p class="p1"><span class="s1">showLoading(true);</span></p>
<p class="p1"><span class="s1">document.getElementById('loadingText').textContent = 'Generating BCOM market summary (fetching full historical data since 2006)...';</span></p>
<p class="p1"><span class="s1">document.getElementById('summarySection').style.display = 'block';</span></p>
<p class="p1"><span class="s1">summaryData = [];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const allBCOMCommodities = [];</span></p>
<p class="p1"><span class="s1">Object.values(BCOM_COMMODITIES).forEach(sector =&gt; {</span></p>
<p class="p1"><span class="s1">sector.forEach(comm =&gt; {</span></p>
<p class="p1"><span class="s1">const match = availableCommodities.find(c =&gt;</span></p>
<p class="p1"><span class="s1">c &amp;&amp; (c.toUpperCase() === comm.cftc_name.toUpperCase() ||</span></p>
<p class="p1"><span class="s1">c.toUpperCase().includes(comm.cftc_name.split(' - ')[0].toUpperCase()))</span></p>
<p class="p1"><span class="s1">);</span></p>
<p class="p1"><span class="s1">if (match) {</span></p>
<p class="p1"><span class="s1">allBCOMCommodities.push({ ...comm, api_name: match });</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const endDate = new Date();</span></p>
<p class="p1"><span class="s1">const startDate = new Date('2006-01-01');</span></p>
<p class="p1"><span class="s1">const startStr = startDate.toISOString().split('T')[0];</span></p>
<p class="p1"><span class="s1">const endStr = endDate.toISOString().split('T')[0];</span></p>
<p class="p1"><span class="s1">const endpoint = ENDPOINTS[reportType];</span></p>
<p class="p1"><span class="s1">const categories = ['managed_money', 'swap_dealers', 'prod_merc', 'other_rept'];</span></p>
<p class="p1"><span class="s1">const categoryNames = {</span></p>
<p class="p1"><span class="s1">'managed_money': 'Managed Money',</span></p>
<p class="p1"><span class="s1">'swap_dealers': 'Swap Dealers',</span></p>
<p class="p1"><span class="s1">'prod_merc': 'Prod/Merch',</span></p>
<p class="p1"><span class="s1">'other_rept': 'Other Reportables'</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">for (let i = 0; i &lt; allBCOMCommodities.length; i++) {</span></p>
<p class="p1"><span class="s1">const commodity = allBCOMCommodities[i];</span></p>
<p class="p1"><span class="s1">for (let cat of categories) {</span></p>
<p class="p1"><span class="s1">document.getElementById('loadingText').textContent =</span></p>
<p class="p1"><span class="s1">`Fetching ${i + 1}/${allBCOMCommodities.length}: ${commodity.name} (${categoryNames[cat]})...`;</span></p>
<p class="p1"><span class="s1">try {</span></p>
<p class="p1"><span class="s1">const query = `$where=market_and_exchange_names='${encodeURIComponent(commodity.api_name)}' AND report_date_as_yyyy_mm_dd &gt;= '${startStr}' AND report_date_as_yyyy_mm_dd &lt;= '${endStr}'&amp;$order=report_date_as_yyyy_mm_dd ASC&amp;$limit=10000`;</span></p>
<p class="p1"><span class="s1">const url = `${endpoint}?${query}`;</span></p>
<p class="p1"><span class="s1">const response = await fetchWithTimeout(url, 20000);</span></p>
<p class="p1"><span class="s1">if (!response.ok) {</span></p>
<p class="p1"><span class="s1">console.warn(`Failed to fetch ${commodity.name}: HTTP ${response.status}`);</span></p>
<p class="p1"><span class="s1">continue;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const data = await response.json();</span></p>
<p class="p1"><span class="s1">if (data.length === 0) {</span></p>
<p class="p1"><span class="s1">console.warn(`No data for ${commodity.name}`);</span></p>
<p class="p1"><span class="s1">continue;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const processed = processData(data, cat);</span></p>
<p class="p1"><span class="s1">if (!processed) {</span></p>
<p class="p1"><span class="s1">console.warn(`Failed to process ${commodity.name} for ${cat}`);</span></p>
<p class="p1"><span class="s1">continue;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const lastIdx = processed.net.length - 1;</span></p>
<p class="p1"><span class="s1">const netMaxHist = Math.max(...processed.net);</span></p>
<p class="p1"><span class="s1">const netMinHist = Math.min(...processed.net);</span></p>
<p class="p1"><span class="s1">const netPctMaxHist = Math.max(...processed.netPct);</span></p>
<p class="p1"><span class="s1">const netPctMinHist = Math.min(...processed.netPct);</span></p>
<p class="p1"><span class="s1">const longMaxHist = Math.max(...processed.long);</span></p>
<p class="p1"><span class="s1">const longMinHist = Math.min(...processed.long);</span></p>
<p class="p1"><span class="s1">const longPctMaxHist = Math.max(...processed.longPct);</span></p>
<p class="p1"><span class="s1">const longPctMinHist = Math.min(...processed.longPct);</span></p>
<p class="p1"><span class="s1">const shortMaxHist = Math.max(...processed.short);</span></p>
<p class="p1"><span class="s1">const shortMinHist = Math.min(...processed.short);</span></p>
<p class="p1"><span class="s1">const shortPctMaxHist = Math.max(...processed.shortPct);</span></p>
<p class="p1"><span class="s1">const shortPctMinHist = Math.min(...processed.shortPct);</span></p>
<p class="p1"><span class="s1">const currentNet = processed.net[lastIdx];</span></p>
<p class="p1"><span class="s1">const currentLong = processed.long[lastIdx];</span></p>
<p class="p1"><span class="s1">const currentShort = processed.short[lastIdx];</span></p>
<p class="p1"><span class="s1">const currentNetPct = processed.netPct[lastIdx];</span></p>
<p class="p1"><span class="s1">const currentLongPct = processed.longPct[lastIdx];</span></p>
<p class="p1"><span class="s1">const currentShortPct = processed.shortPct[lastIdx];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">summaryData.push({</span></p>
<p class="p1"><span class="s1">commodity: commodity.name,</span></p>
<p class="p1"><span class="s1">ticker: commodity.ticker,</span></p>
<p class="p1"><span class="s1">sector: Object.keys(BCOM_COMMODITIES).find(k =&gt; BCOM_COMMODITIES[k].some(c =&gt; c.name === commodity.name)),</span></p>
<p class="p1"><span class="s1">traderCategory: categoryNames[cat],</span></p>
<p class="p1"><span class="s1">traderCatKey: cat,</span></p>
<p class="p1"><span class="s1">netCurrent: currentNet,</span></p>
<p class="p1"><span class="s1">netMaxHist: netMaxHist,</span></p>
<p class="p1"><span class="s1">netMinHist: netMinHist,</span></p>
<p class="p1"><span class="s1">netPctCurrent: currentNetPct,</span></p>
<p class="p1"><span class="s1">netPctMaxHist: netPctMaxHist,</span></p>
<p class="p1"><span class="s1">netPctMinHist: netPctMinHist,</span></p>
<p class="p1"><span class="s1">longCurrent: currentLong,</span></p>
<p class="p1"><span class="s1">longMaxHist: longMaxHist,</span></p>
<p class="p1"><span class="s1">longMinHist: longMinHist,</span></p>
<p class="p1"><span class="s1">longPctCurrent: currentLongPct,</span></p>
<p class="p1"><span class="s1">longPctMaxHist: longPctMaxHist,</span></p>
<p class="p1"><span class="s1">longPctMinHist: longPctMinHist,</span></p>
<p class="p1"><span class="s1">shortCurrent: currentShort,</span></p>
<p class="p1"><span class="s1">shortMaxHist: shortMaxHist,</span></p>
<p class="p1"><span class="s1">shortMinHist: shortMinHist,</span></p>
<p class="p1"><span class="s1">shortPctCurrent: currentShortPct,</span></p>
<p class="p1"><span class="s1">shortPctMaxHist: shortPctMaxHist,</span></p>
<p class="p1"><span class="s1">shortPctMinHist: shortPctMinHist,</span></p>
<p class="p1"><span class="s1">lastDate: processed.dates[lastIdx]</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">} catch (error) {</span></p>
<p class="p1"><span class="s1">console.error(`Error fetching ${commodity.name} for ${cat}:`, error);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">renderSummaryTable();</span></p>
<p class="p1"><span class="s1">showLoading(false);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function createMinMaxBar(current, min, max, isNet = false, isPct = false) {</span></p>
<p class="p1"><span class="s1">if (min === max) return '&lt;div class="minmax-bar-container"&gt;&lt;div class="minmax-bar-bg"&gt;&lt;/div&gt;&lt;/div&gt;';</span></p>
<p class="p1"><span class="s1">const range = max - min;</span></p>
<p class="p1"><span class="s1">const pct = ((current - min) / range) * 100;</span></p>
<p class="p1"><span class="s1">let dotColor = '#2c3e50';</span></p>
<p class="p1"><span class="s1">if (isNet) {</span></p>
<p class="p1"><span class="s1">dotColor = current &gt;= 0 ? '#27ae60' : '#e74c3c';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const formatNum = (num) =&gt; {</span></p>
<p class="p1"><span class="s1">if (isPct) return num.toFixed(1) + '%';</span></p>
<p class="p1"><span class="s1">if (Math.abs(num) &gt;= 1000) return (num/1000).toFixed(1) + 'k';</span></p>
<p class="p1"><span class="s1">return num.toLocaleString();</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">return `</span></p>
<p class="p1"><span class="s1">&lt;div class="minmax-bar-container" title="Min: ${formatNum(min)}, Max: ${formatNum(max)}, Current: ${formatNum(current)}"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="minmax-bar-bg"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="minmax-current" style="left: ${Math.max(5, Math.min(95, pct))}%; background: ${dotColor};"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="minmax-labels"&gt;</span></p>
<p class="p1"><span class="s1">&lt;span&gt;${formatNum(min)}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;span&gt;${formatNum(max)}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function renderSummaryTable() {</span></p>
<p class="p1"><span class="s1">const tbody = document.getElementById('summaryTableBody');</span></p>
<p class="p1"><span class="s1">tbody.innerHTML = '';</span></p>
<p class="p1"><span class="s1">if (summaryData.length === 0) {</span></p>
<p class="p1"><span class="s1">tbody.innerHTML = '&lt;tr&gt;&lt;td colspan="14" style="text-align:center; padding:40px;"&gt;No data available. Check console for details.&lt;/td&gt;&lt;/tr&gt;';</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">summaryData.sort((a, b) =&gt; {</span></p>
<p class="p1"><span class="s1">if (a.sector !== b.sector) return a.sector.localeCompare(b.sector);</span></p>
<p class="p1"><span class="s1">if (a.commodity !== b.commodity) return a.commodity.localeCompare(b.commodity);</span></p>
<p class="p1"><span class="s1">return a.traderCategory.localeCompare(b.traderCategory);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">let currentSector = '';</span></p>
<p class="p1"><span class="s1">let currentCommodity = '';</span></p>
<p class="p1"><span class="s1">summaryData.forEach(item =&gt; {</span></p>
<p class="p1"><span class="s1">if (item.sector !== currentSector) {</span></p>
<p class="p1"><span class="s1">currentSector = item.sector;</span></p>
<p class="p1"><span class="s1">const headerRow = document.createElement('tr');</span></p>
<p class="p1"><span class="s1">headerRow.innerHTML = `&lt;td colspan="14" class="section-header"&gt;${currentSector}&lt;/td&gt;`;</span></p>
<p class="p1"><span class="s1">tbody.appendChild(headerRow);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const row = document.createElement('tr');</span></p>
<p class="p1"><span class="s1">const showCommodity = item.commodity !== currentCommodity;</span></p>
<p class="p1"><span class="s1">currentCommodity = item.commodity;</span></p>
<p class="p1"><span class="s1">row.innerHTML = `</span></p>
<p class="p1"><span class="s1">&lt;td class="commodity-name"&gt;${showCommodity ? `${item.commodity} (${item.ticker})` : ''}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td style="font-weight:600; color:${getTraderColor(item.traderCatKey)}"&gt;${item.traderCategory}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="minmax-cell"&gt;${createMinMaxBar(item.netCurrent, item.netMinHist, item.netMaxHist, true, false)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="data-cell ${item.netCurrent &gt; 0 ? 'positive-value' : item.netCurrent &lt; 0 ? 'negative-value' : ''}"&gt;${item.netCurrent.toLocaleString()}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="minmax-cell"&gt;${createMinMaxBar(item.netPctCurrent, item.netPctMinHist, item.netPctMaxHist, true, true)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="data-cell ${item.netPctCurrent &gt; 0 ? 'positive-value' : item.netPctCurrent &lt; 0 ? 'negative-value' : ''}"&gt;${item.netPctCurrent.toFixed(1)}%&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="minmax-cell"&gt;${createMinMaxBar(item.longCurrent, item.longMinHist, item.longMaxHist, false, false)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="data-cell positive-value"&gt;${item.longCurrent.toLocaleString()}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="minmax-cell"&gt;${createMinMaxBar(item.longPctCurrent, item.longPctMinHist, item.longPctMaxHist, false, true)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="data-cell positive-value"&gt;${item.longPctCurrent.toFixed(1)}%&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="minmax-cell"&gt;${createMinMaxBar(item.shortCurrent, item.shortMinHist, item.shortMaxHist, false, false)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="data-cell negative-value"&gt;${item.shortCurrent.toLocaleString()}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="minmax-cell"&gt;${createMinMaxBar(item.shortPctCurrent, item.shortPctMinHist, item.shortPctMaxHist, false, true)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">&lt;td class="data-cell negative-value"&gt;${item.shortPctCurrent.toFixed(1)}%&lt;/td&gt;</span></p>
<p class="p1"><span class="s1">`;</span></p>
<p class="p1"><span class="s1">tbody.appendChild(row);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function getTraderColor(cat) {</span></p>
<p class="p1"><span class="s1">const colors = {</span></p>
<p class="p1"><span class="s1">'managed_money': '#2a5298',</span></p>
<p class="p1"><span class="s1">'swap_dealers': '#27ae60',</span></p>
<p class="p1"><span class="s1">'prod_merc': '#e67e22',</span></p>
<p class="p1"><span class="s1">'other_rept': '#9b59b6'</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">return colors[cat] || '#333';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function refreshSummary() {</span></p>
<p class="p1"><span class="s1">generateSummary();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">async function fetchData() {</span></p>
<p class="p1"><span class="s1">const commodity = document.getElementById('commoditySelect').value;</span></p>
<p class="p1"><span class="s1">const reportType = document.getElementById('reportType').value;</span></p>
<p class="p1"><span class="s1">const traderCategory = document.getElementById('traderCategory').value;</span></p>
<p class="p1"><span class="s1">const startDate = document.getElementById('startDate').value;</span></p>
<p class="p1"><span class="s1">const endDate = document.getElementById('endDate').value;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if (!commodity) {</span></p>
<p class="p1"><span class="s1">showError('Please select a commodity first');</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if (!startDate || !endDate) {</span></p>
<p class="p1"><span class="s1">showError('Please select both start and end dates');</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if (new Date(startDate) &gt; new Date(endDate)) {</span></p>
<p class="p1"><span class="s1">showError('Start date must be before end date');</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">showLoading(true);</span></p>
<p class="p1"><span class="s1">hideError();</span></p>
<p class="p1"><span class="s1">document.getElementById('warning').style.display = 'none';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">try {</span></p>
<p class="p1"><span class="s1">const endpoint = ENDPOINTS[reportType];</span></p>
<p class="p1"><span class="s1">document.getElementById('loadingText').textContent = 'Fetching data...';</span></p>
<p class="p1"><span class="s1">const query = `$where=market_and_exchange_names='${encodeURIComponent(commodity)}' AND report_date_as_yyyy_mm_dd &gt;= '${startDate}' AND report_date_as_yyyy_mm_dd &lt;= '${endDate}'&amp;$order=report_date_as_yyyy_mm_dd ASC&amp;$limit=10000`;</span></p>
<p class="p1"><span class="s1">const url = `${endpoint}?${query}`;</span></p>
<p class="p1"><span class="s1">debugInfo.lastUrl = url;</span></p>
<p class="p1"><span class="s1">debugInfo.commodity = commodity;</span></p>
<p class="p1"><span class="s1">debugInfo.traderCategory = traderCategory;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const response = await fetchWithTimeout(url, 30000);</span></p>
<p class="p1"><span class="s1">if (!response.ok) {</span></p>
<p class="p1"><span class="s1">throw new Error(`HTTP ${response.status}: ${response.statusText}`);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const data = await response.json();</span></p>
<p class="p1"><span class="s1">debugInfo.recordCount = data.length;</span></p>
<p class="p1"><span class="s1">debugInfo.lastResponse = data;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if (data.length === 0) {</span></p>
<p class="p1"><span class="s1">throw new Error('No data found for selected criteria. Try a different date range or commodity.');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">currentData = processData(data, traderCategory);</span></p>
<p class="p1"><span class="s1">if (!currentData) {</span></p>
<p class="p1"><span class="s1">throw new Error('Failed to process data - could not find required fields');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">historicalExtremes = {</span></p>
<p class="p1"><span class="s1">net: { min: Math.min(...currentData.net), max: Math.max(...currentData.net) },</span></p>
<p class="p1"><span class="s1">long: { min: Math.min(...currentData.long), max: Math.max(...currentData.long) },</span></p>
<p class="p1"><span class="s1">short: { min: Math.min(...currentData.short), max: Math.max(...currentData.short) },</span></p>
<p class="p1"><span class="s1">netPct: { min: Math.min(...currentData.netPct), max: Math.max(...currentData.netPct) }</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">populateYearSelector();</span></p>
<p class="p1"><span class="s1">document.getElementById('chart1').style.display = 'block';</span></p>
<p class="p1"><span class="s1">document.getElementById('chart2').style.display = 'block';</span></p>
<p class="p1"><span class="s1">document.getElementById('chart3').style.display = 'block';</span></p>
<p class="p1"><span class="s1">document.getElementById('chart4').style.display = 'block';</span></p>
<p class="p1"><span class="s1">document.getElementById('statsGrid').style.display = 'grid';</span></p>
<p class="p1"><span class="s1">updateAllCharts();</span></p>
<p class="p1"><span class="s1">updateStats();</span></p>
<p class="p1"><span class="s1">checkDataQuality();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">} catch (error) {</span></p>
<p class="p1"><span class="s1">debugInfo.error = error.message;</span></p>
<p class="p1"><span class="s1">console.error('Fetch error:', error);</span></p>
<p class="p1"><span class="s1">showError(`Error fetching data: ${error.message}`);</span></p>
<p class="p1"><span class="s1">} finally {</span></p>
<p class="p1"><span class="s1">showLoading(false);</span></p>
<p class="p1"><span class="s1">updateDebugPanel();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function populateYearSelector() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const years = [...new Set(currentData.dates.map(d =&gt; new Date(d).getFullYear()))].sort();</span></p>
<p class="p1"><span class="s1">const container = document.getElementById('yearSelector');</span></p>
<p class="p1"><span class="s1">container.innerHTML = '&lt;strong style="width:100%; margin-bottom:5px;"&gt;Select Years to Display (Weekly Data):&lt;/strong&gt;';</span></p>
<p class="p1"><span class="s1">const defaultYears = years.slice(-3); // Default to last 3 years for weekly view</span></p>
<p class="p1"><span class="s1">selectedYears = new Set(defaultYears);</span></p>
<p class="p1"><span class="s1">years.forEach(year =&gt; {</span></p>
<p class="p1"><span class="s1">const chip = document.createElement('div');</span></p>
<p class="p1"><span class="s1">chip.className = 'year-chip' + (selectedYears.has(year) ? ' active' : '');</span></p>
<p class="p1"><span class="s1">chip.textContent = year;</span></p>
<p class="p1"><span class="s1">chip.onclick = () =&gt; toggleYear(year, chip);</span></p>
<p class="p1"><span class="s1">container.appendChild(chip);</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function toggleYear(year, element) {</span></p>
<p class="p1"><span class="s1">if (selectedYears.has(year)) {</span></p>
<p class="p1"><span class="s1">if (selectedYears.size &gt; 1) {</span></p>
<p class="p1"><span class="s1">selectedYears.delete(year);</span></p>
<p class="p1"><span class="s1">element.classList.remove('active');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">} else {</span></p>
<p class="p1"><span class="s1">selectedYears.add(year);</span></p>
<p class="p1"><span class="s1">element.classList.add('active');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">updateSeasonalityChart();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function processData(rawData, traderCategory = 'managed_money') {</span></p>
<p class="p1"><span class="s1">if (!rawData || rawData.length === 0) return null;</span></p>
<p class="p1"><span class="s1">rawData.sort((a, b) =&gt; new Date(a.report_date_as_yyyy_mm_dd) - new Date(b.report_date_as_yyyy_mm_dd));</span></p>
<p class="p1"><span class="s1">const first = rawData[0];</span></p>
<p class="p1"><span class="s1">debugInfo.sampleRecord = first;</span></p>
<p class="p1"><span class="s1">const fieldMap = TRADER_FIELDS[traderCategory] || TRADER_FIELDS.managed_money;</span></p>
<p class="p1"><span class="s1">const fields = detectAllFields(first, fieldMap);</span></p>
<p class="p1"><span class="s1">debugInfo.detectedFields = fields;</span></p>
<p class="p1"><span class="s1">console.log('Detected fields for', traderCategory, ':', fields);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if (!fields.long || !fields.short) {</span></p>
<p class="p1"><span class="s1">console.error('Could not find position fields. Available fields:', Object.keys(first));</span></p>
<p class="p1"><span class="s1">return null;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const safeParseInt = (val) =&gt; {</span></p>
<p class="p1"><span class="s1">if (val === null || val === undefined || val === '') return 0;</span></p>
<p class="p1"><span class="s1">const parsed = parseInt(val);</span></p>
<p class="p1"><span class="s1">return isNaN(parsed) ? 0 : parsed;</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const processed = {</span></p>
<p class="p1"><span class="s1">dates: rawData.map(d =&gt; d.report_date_as_yyyy_mm_dd),</span></p>
<p class="p1"><span class="s1">long: rawData.map(d =&gt; safeParseInt(d[fields.long])),</span></p>
<p class="p1"><span class="s1">short: rawData.map(d =&gt; safeParseInt(d[fields.short])),</span></p>
<p class="p1"><span class="s1">spread: fields.spread ? rawData.map(d =&gt; safeParseInt(d[fields.spread])) : new Array(rawData.length).fill(0),</span></p>
<p class="p1"><span class="s1">tradersLong: fields.tradersLong ? rawData.map(d =&gt; safeParseInt(d[fields.tradersLong])) : new Array(rawData.length).fill(0),</span></p>
<p class="p1"><span class="s1">tradersShort: fields.tradersShort ? rawData.map(d =&gt; safeParseInt(d[fields.tradersShort])) : new Array(rawData.length).fill(0),</span></p>
<p class="p1"><span class="s1">tradersTotal: [],</span></p>
<p class="p1"><span class="s1">oi: fields.oi ? rawData.map(d =&gt; safeParseInt(d[fields.oi])) : new Array(rawData.length).fill(0),</span></p>
<p class="p1"><span class="s1">commodity: first.market_and_exchange_names,</span></p>
<p class="p1"><span class="s1">fields: fields,</span></p>
<p class="p1"><span class="s1">traderCategory: traderCategory,</span></p>
<p class="p1"><span class="s1">rawData: rawData</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">processed.tradersTotal = processed.tradersLong.map((l, i) =&gt; l + processed.tradersShort[i]);</span></p>
<p class="p1"><span class="s1">processed.net = processed.long.map((l, i) =&gt; l - processed.short[i]);</span></p>
<p class="p1"><span class="s1">processed.longPct = processed.oi.map((oi, i) =&gt; oi &gt; 0 ? (processed.long[i] / oi * 100) : 0);</span></p>
<p class="p1"><span class="s1">processed.shortPct = processed.oi.map((oi, i) =&gt; oi &gt; 0 ? (processed.short[i] / oi * 100) : 0);</span></p>
<p class="p1"><span class="s1">processed.netPct = processed.longPct.map((l, i) =&gt; l - processed.shortPct[i]);</span></p>
<p class="p1"><span class="s1">processed.perTraderLong = processed.tradersLong.map((t, i) =&gt; t &gt; 0 ? processed.long[i] / t : 0);</span></p>
<p class="p1"><span class="s1">processed.perTraderShort = processed.tradersShort.map((t, i) =&gt; t &gt; 0 ? processed.short[i] / t : 0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">return processed;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function detectAllFields(record, fieldMap) {</span></p>
<p class="p1"><span class="s1">const fields = {};</span></p>
<p class="p1"><span class="s1">const allKeys = Object.keys(record);</span></p>
<p class="p1"><span class="s1">fields.long = findFieldFromMap(record, fieldMap.long);</span></p>
<p class="p1"><span class="s1">fields.short = findFieldFromMap(record, fieldMap.short);</span></p>
<p class="p1"><span class="s1">fields.spread = findFieldFromMap(record, fieldMap.spread);</span></p>
<p class="p1"><span class="s1">fields.tradersLong = findFieldFromMap(record, fieldMap.traders_long);</span></p>
<p class="p1"><span class="s1">fields.tradersShort = findFieldFromMap(record, fieldMap.traders_short);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Fallback for trader counts</span></p>
<p class="p1"><span class="s1">if (!fields.tradersLong || !fields.tradersShort) {</span></p>
<p class="p1"><span class="s1">let traderCategory = 'm_money';</span></p>
<p class="p1"><span class="s1">if (fieldMap === TRADER_FIELDS.swap_dealers) {</span></p>
<p class="p1"><span class="s1">traderCategory = 'swap';</span></p>
<p class="p1"><span class="s1">} else if (fieldMap === TRADER_FIELDS.prod_merc) {</span></p>
<p class="p1"><span class="s1">traderCategory = 'prod_merc';</span></p>
<p class="p1"><span class="s1">} else if (fieldMap === TRADER_FIELDS.other_rept) {</span></p>
<p class="p1"><span class="s1">traderCategory = 'other_rept';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const possibleLongFields = [</span></p>
<p class="p1"><span class="s1">`traders_${traderCategory}_long_all`,</span></p>
<p class="p1"><span class="s1">`traders_${traderCategory}_long`</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p1"><span class="s1">fields.tradersLong = findFieldFromMap(record, possibleLongFields) || fields.tradersLong;</span></p>
<p class="p1"><span class="s1">const possibleShortFields = [</span></p>
<p class="p1"><span class="s1">`traders_${traderCategory}_short_all`,</span></p>
<p class="p1"><span class="s1">`traders_${traderCategory}_short`</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p1"><span class="s1">fields.tradersShort = findFieldFromMap(record, possibleShortFields) || fields.tradersShort;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">fields.oi = findField(record, [</span></p>
<p class="p1"><span class="s1">'open_interest_all', 'open_interest', 'oi', 'total_open_interest'</span></p>
<p class="p1"><span class="s1">]);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">return fields;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function findFieldFromMap(record, patterns) {</span></p>
<p class="p1"><span class="s1">if (!patterns || !Array.isArray(patterns)) return null;</span></p>
<p class="p1"><span class="s1">for (let pattern of patterns) {</span></p>
<p class="p1"><span class="s1">if (record.hasOwnProperty(pattern) &amp;&amp; record[pattern] !== null &amp;&amp; record[pattern] !== undefined) {</span></p>
<p class="p1"><span class="s1">return pattern;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const keys = Object.keys(record);</span></p>
<p class="p1"><span class="s1">for (let pattern of patterns) {</span></p>
<p class="p1"><span class="s1">const lowerPattern = pattern.toLowerCase();</span></p>
<p class="p1"><span class="s1">const match = keys.find(k =&gt; k.toLowerCase() === lowerPattern);</span></p>
<p class="p1"><span class="s1">if (match) return match;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">return null;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function findField(record, patterns) {</span></p>
<p class="p1"><span class="s1">if (!record || typeof record !== 'object') return null;</span></p>
<p class="p1"><span class="s1">const keys = Object.keys(record);</span></p>
<p class="p1"><span class="s1">for (let pattern of patterns) {</span></p>
<p class="p1"><span class="s1">if (record.hasOwnProperty(pattern) &amp;&amp; record[pattern] !== null &amp;&amp; record[pattern] !== undefined) {</span></p>
<p class="p1"><span class="s1">const val = record[pattern];</span></p>
<p class="p1"><span class="s1">if (typeof val === 'number' || (typeof val === 'string' &amp;&amp; val !== '' &amp;&amp; !isNaN(parseFloat(val)))) {</span></p>
<p class="p1"><span class="s1">return pattern;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">for (let pattern of patterns) {</span></p>
<p class="p1"><span class="s1">const lowerPattern = pattern.toLowerCase();</span></p>
<p class="p1"><span class="s1">const match = keys.find(k =&gt; k.toLowerCase() === lowerPattern);</span></p>
<p class="p1"><span class="s1">if (match &amp;&amp; record[match] !== null &amp;&amp; record[match] !== undefined) {</span></p>
<p class="p1"><span class="s1">return match;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">return null;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function checkDataQuality() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const warnings = [];</span></p>
<p class="p1"><span class="s1">const hasPositions = currentData.long.some(v =&gt; v !== 0) || currentData.short.some(v =&gt; v !== 0);</span></p>
<p class="p1"><span class="s1">if (!hasPositions) {</span></p>
<p class="p1"><span class="s1">warnings.push('All position values are zero - API fields may have changed');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const hasTraders = currentData.tradersTotal.some(v =&gt; v &gt; 0);</span></p>
<p class="p1"><span class="s1">if (!hasTraders) {</span></p>
<p class="p1"><span class="s1">warnings.push('No trader count data available for this commodity/category');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if (warnings.length &gt; 0) {</span></p>
<p class="p1"><span class="s1">const warningDiv = document.getElementById('warning');</span></p>
<p class="p1"><span class="s1">warningDiv.innerHTML = '&lt;strong&gt;Data Quality Warnings:&lt;/strong&gt;&lt;br&gt;' + warnings.join('&lt;br&gt;');</span></p>
<p class="p1"><span class="s1">warningDiv.style.display = 'block';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateAllCharts() {</span></p>
<p class="p1"><span class="s1">updatePositionChart();</span></p>
<p class="p1"><span class="s1">updateTraderChart();</span></p>
<p class="p1"><span class="s1">updateSizeChart();</span></p>
<p class="p1"><span class="s1">updateSeasonalityChart();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updatePositionChart() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const metric = document.getElementById('positionMetric').value;</span></p>
<p class="p1"><span class="s1">const ctx = document.getElementById('positionChart').getContext('2d');</span></p>
<p class="p1"><span class="s1">if (charts.position) charts.position.destroy();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let values, label, color, isPercentage = false, showZeroLine = false;</span></p>
<p class="p1"><span class="s1">switch(metric) {</span></p>
<p class="p1"><span class="s1">case 'net':</span></p>
<p class="p1"><span class="s1">values = currentData.net;</span></p>
<p class="p1"><span class="s1">label = 'Net Position (Long - Short)';</span></p>
<p class="p1"><span class="s1">color = '#2a5298';</span></p>
<p class="p1"><span class="s1">showZeroLine = true;</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'long':</span></p>
<p class="p1"><span class="s1">values = currentData.long;</span></p>
<p class="p1"><span class="s1">label = 'Long Positions';</span></p>
<p class="p1"><span class="s1">color = '#27ae60';</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'short':</span></p>
<p class="p1"><span class="s1">values = currentData.short;</span></p>
<p class="p1"><span class="s1">label = 'Short Positions';</span></p>
<p class="p1"><span class="s1">color = '#e74c3c';</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'spread':</span></p>
<p class="p1"><span class="s1">values = currentData.spread;</span></p>
<p class="p1"><span class="s1">label = 'Spreading Positions';</span></p>
<p class="p1"><span class="s1">color = '#f39c12';</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'net_pct':</span></p>
<p class="p1"><span class="s1">values = currentData.netPct;</span></p>
<p class="p1"><span class="s1">label = 'Net as % of Open Interest';</span></p>
<p class="p1"><span class="s1">color = '#2a5298';</span></p>
<p class="p1"><span class="s1">isPercentage = true;</span></p>
<p class="p1"><span class="s1">showZeroLine = true;</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'long_pct':</span></p>
<p class="p1"><span class="s1">values = currentData.longPct;</span></p>
<p class="p1"><span class="s1">label = 'Long as % of Open Interest';</span></p>
<p class="p1"><span class="s1">color = '#27ae60';</span></p>
<p class="p1"><span class="s1">isPercentage = true;</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'short_pct':</span></p>
<p class="p1"><span class="s1">values = currentData.shortPct;</span></p>
<p class="p1"><span class="s1">label = 'Short as % of Open Interest';</span></p>
<p class="p1"><span class="s1">color = '#e74c3c';</span></p>
<p class="p1"><span class="s1">isPercentage = true;</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const datasets = [{</span></p>
<p class="p1"><span class="s1">label: label,</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: values[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: color,</span></p>
<p class="p1"><span class="s1">backgroundColor: color + '20',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 6,</span></p>
<p class="p1"><span class="s1">fill: true,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if (showZeroLine) {</span></p>
<p class="p1"><span class="s1">datasets.push({</span></p>
<p class="p1"><span class="s1">label: 'Zero Line',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map(date =&gt; ({ x: date, y: 0 })),</span></p>
<p class="p1"><span class="s1">borderColor: 'rgba(231, 76, 60, 0.3)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">borderDash: [5, 5],</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">fill: false</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">charts.position = new Chart(ctx, {</span></p>
<p class="p1"><span class="s1">type: 'line',</span></p>
<p class="p1"><span class="s1">data: { datasets: datasets },</span></p>
<p class="p1"><span class="s1">options: {</span></p>
<p class="p1"><span class="s1">responsive: true,</span></p>
<p class="p1"><span class="s1">maintainAspectRatio: false,</span></p>
<p class="p1"><span class="s1">interaction: { mode: 'index', intersect: false },</span></p>
<p class="p1"><span class="s1">plugins: {</span></p>
<p class="p1"><span class="s1">legend: { display: false },</span></p>
<p class="p1"><span class="s1">tooltip: {</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(0,0,0,0.8)',</span></p>
<p class="p1"><span class="s1">callbacks: {</span></p>
<p class="p1"><span class="s1">label: function(context) {</span></p>
<p class="p1"><span class="s1">const val = isPercentage ? context.parsed.y.toFixed(2) + '%' : context.parsed.y.toLocaleString();</span></p>
<p class="p1"><span class="s1">return context.dataset.label + ': ' + val + (isPercentage ? '' : ' contracts');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">scales: {</span></p>
<p class="p1"><span class="s1">x: {</span></p>
<p class="p1"><span class="s1">type: 'time',</span></p>
<p class="p1"><span class="s1">time: { unit: 'month', displayFormats: { month: 'MMM yyyy' } },</span></p>
<p class="p1"><span class="s1">grid: { display: false },</span></p>
<p class="p1"><span class="s1">ticks: { maxTicksLimit: 12 }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">y: {</span></p>
<p class="p1"><span class="s1">beginAtZero: !showZeroLine,</span></p>
<p class="p1"><span class="s1">grid: { color: 'rgba(0,0,0,0.05)' },</span></p>
<p class="p1"><span class="s1">ticks: {</span></p>
<p class="p1"><span class="s1">callback: function(value) {</span></p>
<p class="p1"><span class="s1">return isPercentage ? value.toFixed(1) + '%' : value.toLocaleString();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">title: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">text: isPercentage ? '% of Open Interest' : 'Contracts',</span></p>
<p class="p1"><span class="s1">font: { weight: 'bold' }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">document.getElementById('positionLegend').style.display = showZeroLine ? 'flex' : 'none';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateTraderChart() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const metric = document.getElementById('traderMetric').value;</span></p>
<p class="p1"><span class="s1">const ctx = document.getElementById('traderChart').getContext('2d');</span></p>
<p class="p1"><span class="s1">if (charts.trader) charts.trader.destroy();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let datasets = [];</span></p>
<p class="p1"><span class="s1">switch(metric) {</span></p>
<p class="p1"><span class="s1">case 'total':</span></p>
<p class="p1"><span class="s1">datasets = [{</span></p>
<p class="p1"><span class="s1">label: 'Total Traders',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.tradersTotal[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#2a5298',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(42, 82, 152, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: true,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'long':</span></p>
<p class="p1"><span class="s1">datasets = [{</span></p>
<p class="p1"><span class="s1">label: 'Long Traders',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.tradersLong[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#27ae60',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(39, 174, 96, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: true,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'short':</span></p>
<p class="p1"><span class="s1">datasets = [{</span></p>
<p class="p1"><span class="s1">label: 'Short Traders',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.tradersShort[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#e74c3c',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(231, 76, 60, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: true,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'both':</span></p>
<p class="p1"><span class="s1">datasets = [</span></p>
<p class="p1"><span class="s1">{</span></p>
<p class="p1"><span class="s1">label: 'Long Traders',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.tradersLong[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#27ae60',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(39, 174, 96, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: false,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">{</span></p>
<p class="p1"><span class="s1">label: 'Short Traders',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.tradersShort[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#e74c3c',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(231, 76, 60, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: false,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">charts.trader = new Chart(ctx, {</span></p>
<p class="p1"><span class="s1">type: 'line',</span></p>
<p class="p1"><span class="s1">data: { datasets: datasets },</span></p>
<p class="p1"><span class="s1">options: {</span></p>
<p class="p1"><span class="s1">responsive: true,</span></p>
<p class="p1"><span class="s1">maintainAspectRatio: false,</span></p>
<p class="p1"><span class="s1">interaction: { mode: 'index', intersect: false },</span></p>
<p class="p1"><span class="s1">plugins: {</span></p>
<p class="p1"><span class="s1">legend: {</span></p>
<p class="p1"><span class="s1">display: metric === 'both',</span></p>
<p class="p1"><span class="s1">position: 'top'</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">scales: {</span></p>
<p class="p1"><span class="s1">x: {</span></p>
<p class="p1"><span class="s1">type: 'time',</span></p>
<p class="p1"><span class="s1">time: { unit: 'month', displayFormats: { month: 'MMM yyyy' } },</span></p>
<p class="p1"><span class="s1">grid: { display: false },</span></p>
<p class="p1"><span class="s1">ticks: { maxTicksLimit: 12 }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">y: {</span></p>
<p class="p1"><span class="s1">beginAtZero: true,</span></p>
<p class="p1"><span class="s1">grid: { color: 'rgba(0,0,0,0.05)' },</span></p>
<p class="p1"><span class="s1">title: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">text: 'Number of Traders',</span></p>
<p class="p1"><span class="s1">font: { weight: 'bold' }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">ticks: { stepSize: 1 }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateSizeChart() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const metric = document.getElementById('sizeMetric').value;</span></p>
<p class="p1"><span class="s1">const ctx = document.getElementById('sizeChart').getContext('2d');</span></p>
<p class="p1"><span class="s1">if (charts.size) charts.size.destroy();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">let datasets = [];</span></p>
<p class="p1"><span class="s1">switch(metric) {</span></p>
<p class="p1"><span class="s1">case 'per_trader_long':</span></p>
<p class="p1"><span class="s1">datasets = [{</span></p>
<p class="p1"><span class="s1">label: 'Contracts per Trader (Long)',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.perTraderLong[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#27ae60',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(39, 174, 96, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: true,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'per_trader_short':</span></p>
<p class="p1"><span class="s1">datasets = [{</span></p>
<p class="p1"><span class="s1">label: 'Contracts per Trader (Short)',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.perTraderShort[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#e74c3c',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(231, 76, 60, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: true,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">case 'long_vs_short':</span></p>
<p class="p1"><span class="s1">datasets = [</span></p>
<p class="p1"><span class="s1">{</span></p>
<p class="p1"><span class="s1">label: 'Long per Trader',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.perTraderLong[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#27ae60',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(39, 174, 96, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: false,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">{</span></p>
<p class="p1"><span class="s1">label: 'Short per Trader',</span></p>
<p class="p1"><span class="s1">data: currentData.dates.map((date, i) =&gt; ({ x: date, y: currentData.perTraderShort[i] })),</span></p>
<p class="p1"><span class="s1">borderColor: '#e74c3c',</span></p>
<p class="p1"><span class="s1">backgroundColor: 'rgba(231, 76, 60, 0.1)',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 0,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 4,</span></p>
<p class="p1"><span class="s1">fill: false,</span></p>
<p class="p1"><span class="s1">tension: 0.4</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p1"><span class="s1">break;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">charts.size = new Chart(ctx, {</span></p>
<p class="p1"><span class="s1">type: 'line',</span></p>
<p class="p1"><span class="s1">data: { datasets: datasets },</span></p>
<p class="p1"><span class="s1">options: {</span></p>
<p class="p1"><span class="s1">responsive: true,</span></p>
<p class="p1"><span class="s1">maintainAspectRatio: false,</span></p>
<p class="p1"><span class="s1">interaction: { mode: 'index', intersect: false },</span></p>
<p class="p1"><span class="s1">plugins: {</span></p>
<p class="p1"><span class="s1">legend: {</span></p>
<p class="p1"><span class="s1">display: metric === 'long_vs_short',</span></p>
<p class="p1"><span class="s1">position: 'top'</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">tooltip: {</span></p>
<p class="p1"><span class="s1">callbacks: {</span></p>
<p class="p1"><span class="s1">label: function(context) {</span></p>
<p class="p1"><span class="s1">return context.dataset.label + ': ' + Math.round(context.parsed.y).toLocaleString() + ' contracts';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">scales: {</span></p>
<p class="p1"><span class="s1">x: {</span></p>
<p class="p1"><span class="s1">type: 'time',</span></p>
<p class="p1"><span class="s1">time: { unit: 'month', displayFormats: { month: 'MMM yyyy' } },</span></p>
<p class="p1"><span class="s1">grid: { display: false },</span></p>
<p class="p1"><span class="s1">ticks: { maxTicksLimit: 12 }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">y: {</span></p>
<p class="p1"><span class="s1">beginAtZero: true,</span></p>
<p class="p1"><span class="s1">grid: { color: 'rgba(0,0,0,0.05)' },</span></p>
<p class="p1"><span class="s1">title: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">text: 'Contracts per Trader',</span></p>
<p class="p1"><span class="s1">font: { weight: 'bold' }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// FIXED: Weekly seasonality chart instead of monthly aggregation</span></p>
<p class="p1"><span class="s1">function updateSeasonalityChart() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const metric = document.getElementById('seasonalityMetric').value;</span></p>
<p class="p1"><span class="s1">const ctx = document.getElementById('seasonalityChart').getContext('2d');</span></p>
<p class="p1"><span class="s1">if (charts.seasonality) charts.seasonality.destroy();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const filteredIndices = currentData.dates</span></p>
<p class="p1"><span class="s1">.map((date, idx) =&gt; ({ date, idx, year: new Date(date).getFullYear() }))</span></p>
<p class="p1"><span class="s1">.filter(d =&gt; selectedYears.has(d.year));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">if (filteredIndices.length === 0) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Group by year and week number</span></p>
<p class="p1"><span class="s1">const yearGroups = {};</span></p>
<p class="p1"><span class="s1">filteredIndices.forEach(({ date, idx, year }) =&gt; {</span></p>
<p class="p1"><span class="s1">if (!yearGroups[year]) yearGroups[year] = [];</span></p>
<p class="p1"><span class="s1">const weekNum = getWeekNumber(new Date(date));</span></p>
<p class="p1"><span class="s1">yearGroups[year].push({ date, idx, weekNum });</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const baseColors = [</span></p>
<p class="p1"><span class="s1">'#e74c3c', '#e67e22', '#f39c12', '#27ae60',</span></p>
<p class="p1"><span class="s1">'#2980b9', '#8e44ad', '#2c3e50', '#16a085',</span></p>
<p class="p1"><span class="s1">'#d35400', '#c0392b', '#7f8c8d', '#2ecc71'</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Create datasets for each year - showing weekly data points</span></p>
<p class="p1"><span class="s1">const datasets = Object.keys(yearGroups).sort().map((year, index) =&gt; {</span></p>
<p class="p1"><span class="s1">const yearData = yearGroups[year];</span></p>
<p class="p1"><span class="s1">const color = baseColors[index % baseColors.length];</span></p>
<p class="p1"><span class="s1">const weeklyData = new Array(53).fill(null); // 53 weeks max</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">yearData.forEach(({ idx, weekNum }) =&gt; {</span></p>
<p class="p1"><span class="s1">const value = getMetricValue(metric, idx);</span></p>
<p class="p1"><span class="s1">if (weekNum &gt;= 1 &amp;&amp; weekNum &lt;= 53) {</span></p>
<p class="p1"><span class="s1">weeklyData[weekNum - 1] = value;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">return {</span></p>
<p class="p1"><span class="s1">label: year.toString(),</span></p>
<p class="p1"><span class="s1">data: weeklyData,</span></p>
<p class="p1"><span class="s1">borderColor: color,</span></p>
<p class="p1"><span class="s1">backgroundColor: color + '20',</span></p>
<p class="p1"><span class="s1">borderWidth: 2,</span></p>
<p class="p1"><span class="s1">pointRadius: 3,</span></p>
<p class="p1"><span class="s1">pointHoverRadius: 6,</span></p>
<p class="p1"><span class="s1">fill: false,</span></p>
<p class="p1"><span class="s1">tension: 0.1,</span></p>
<p class="p1"><span class="s1">spanGaps: true</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Create week labels</span></p>
<p class="p1"><span class="s1">const weekLabels = [];</span></p>
<p class="p1"><span class="s1">for (let i = 1; i &lt;= 53; i++) {</span></p>
<p class="p1"><span class="s1">weekLabels.push('W' + i);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">charts.seasonality = new Chart(ctx, {</span></p>
<p class="p1"><span class="s1">type: 'line',</span></p>
<p class="p1"><span class="s1">data: {</span></p>
<p class="p1"><span class="s1">labels: weekLabels,</span></p>
<p class="p1"><span class="s1">datasets: datasets</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">options: {</span></p>
<p class="p1"><span class="s1">responsive: true,</span></p>
<p class="p1"><span class="s1">maintainAspectRatio: false,</span></p>
<p class="p1"><span class="s1">interaction: { mode: 'index', intersect: false },</span></p>
<p class="p1"><span class="s1">plugins: {</span></p>
<p class="p1"><span class="s1">legend: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">position: 'top',</span></p>
<p class="p1"><span class="s1">labels: { usePointStyle: true, padding: 20 }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">title: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">text: `${getMetricLabel(metric)} - Weekly Patterns (52-Week Seasonality)`,</span></p>
<p class="p1"><span class="s1">font: { size: 16, weight: 'bold' }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">tooltip: {</span></p>
<p class="p1"><span class="s1">callbacks: {</span></p>
<p class="p1"><span class="s1">title: function(context) {</span></p>
<p class="p1"><span class="s1">return 'Week ' + (context[0].dataIndex + 1);</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">label: function(context) {</span></p>
<p class="p1"><span class="s1">const val = context.parsed.y;</span></p>
<p class="p1"><span class="s1">if (val === null) return `${context.dataset.label}: No data`;</span></p>
<p class="p1"><span class="s1">return `${context.dataset.label}: ${metric.includes('pct') ? val.toFixed(2) + '%' : Math.round(val).toLocaleString()}`;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">scales: {</span></p>
<p class="p1"><span class="s1">x: {</span></p>
<p class="p1"><span class="s1">grid: { display: false },</span></p>
<p class="p1"><span class="s1">title: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">text: 'Week Number (1-53)',</span></p>
<p class="p1"><span class="s1">font: { weight: 'bold' }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">ticks: {</span></p>
<p class="p1"><span class="s1">maxTicksLimit: 26,</span></p>
<p class="p1"><span class="s1">callback: function(val, index) {</span></p>
<p class="p1"><span class="s1">return (index % 4 === 0) ? this.getLabelForValue(val) : '';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">y: {</span></p>
<p class="p1"><span class="s1">beginAtZero: !metric.includes('net'),</span></p>
<p class="p1"><span class="s1">grid: { color: 'rgba(0,0,0,0.05)' },</span></p>
<p class="p1"><span class="s1">title: {</span></p>
<p class="p1"><span class="s1">display: true,</span></p>
<p class="p1"><span class="s1">text: getMetricLabel(metric),</span></p>
<p class="p1"><span class="s1">font: { weight: 'bold' }</span></p>
<p class="p1"><span class="s1">},</span></p>
<p class="p1"><span class="s1">ticks: {</span></p>
<p class="p1"><span class="s1">callback: function(value) {</span></p>
<p class="p1"><span class="s1">return metric.includes('pct') ? value.toFixed(0) + '%' :</span></p>
<p class="p1"><span class="s1">value &gt;= 1000 ? (value/1000).toFixed(1) + 'k' : value;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Helper function to get ISO week number</span></p>
<p class="p1"><span class="s1">function getWeekNumber(date) {</span></p>
<p class="p1"><span class="s1">const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));</span></p>
<p class="p1"><span class="s1">const dayNum = d.getUTCDay() || 7;</span></p>
<p class="p1"><span class="s1">d.setUTCDate(d.getUTCDate() + 4 - dayNum);</span></p>
<p class="p1"><span class="s1">const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));</span></p>
<p class="p1"><span class="s1">return Math.ceil((((d - yearStart) / 86400000) + 1)/7);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function getMetricLabel(metric) {</span></p>
<p class="p1"><span class="s1">const labels = {</span></p>
<p class="p1"><span class="s1">'net': 'Net Position',</span></p>
<p class="p1"><span class="s1">'long': 'Long Positions',</span></p>
<p class="p1"><span class="s1">'short': 'Short Positions',</span></p>
<p class="p1"><span class="s1">'net_pct': 'Net % of OI',</span></p>
<p class="p1"><span class="s1">'traders_total': 'Total Traders',</span></p>
<p class="p1"><span class="s1">'per_trader_long': 'Contracts per Trader (Long)',</span></p>
<p class="p1"><span class="s1">'per_trader_short': 'Contracts per Trader (Short)'</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">return labels[metric] || metric;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function getMetricValue(metric, idx) {</span></p>
<p class="p1"><span class="s1">switch(metric) {</span></p>
<p class="p1"><span class="s1">case 'net': return currentData.net[idx];</span></p>
<p class="p1"><span class="s1">case 'long': return currentData.long[idx];</span></p>
<p class="p1"><span class="s1">case 'short': return currentData.short[idx];</span></p>
<p class="p1"><span class="s1">case 'net_pct': return currentData.netPct[idx];</span></p>
<p class="p1"><span class="s1">case 'traders_total': return currentData.tradersTotal[idx];</span></p>
<p class="p1"><span class="s1">case 'per_trader_long': return currentData.perTraderLong[idx];</span></p>
<p class="p1"><span class="s1">case 'per_trader_short': return currentData.perTraderShort[idx];</span></p>
<p class="p1"><span class="s1">default: return 0;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateStats() {</span></p>
<p class="p1"><span class="s1">if (!currentData) return;</span></p>
<p class="p1"><span class="s1">const idx = currentData.net.length - 1;</span></p>
<p class="p1"><span class="s1">const prevIdx = Math.max(0, idx - 1);</span></p>
<p class="p1"><span class="s1">const net = currentData.net[idx];</span></p>
<p class="p1"><span class="s1">const long = currentData.long[idx];</span></p>
<p class="p1"><span class="s1">const short = currentData.short[idx];</span></p>
<p class="p1"><span class="s1">const oi = currentData.oi[idx];</span></p>
<p class="p1"><span class="s1">const tradersTotal = currentData.tradersTotal[idx];</span></p>
<p class="p1"><span class="s1">const tradersLong = currentData.tradersLong[idx];</span></p>
<p class="p1"><span class="s1">const tradersShort = currentData.tradersShort[idx];</span></p>
<p class="p1"><span class="s1">const prevNet = currentData.net[prevIdx];</span></p>
<p class="p1"><span class="s1">const change = net - prevNet;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">document.getElementById('currentNet').textContent = net.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('currentNet').className = 'stat-value ' + (net &gt; 0 ? 'positive' : net &lt; 0 ? 'negative' : '');</span></p>
<p class="p1"><span class="s1">document.getElementById('currentNetPct').textContent = `(${currentData.netPct[idx].toFixed(1)}% of OI)`;</span></p>
<p class="p1"><span class="s1">document.getElementById('currentLong').textContent = long.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('currentLongPct').textContent = `${currentData.longPct[idx].toFixed(1)}% of OI`;</span></p>
<p class="p1"><span class="s1">document.getElementById('currentShort').textContent = short.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('currentShortPct').textContent = `${currentData.shortPct[idx].toFixed(1)}% of OI`;</span></p>
<p class="p1"><span class="s1">document.getElementById('numTraders').textContent = tradersTotal.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('tradersLong').textContent = tradersLong;</span></p>
<p class="p1"><span class="s1">document.getElementById('tradersShort').textContent = tradersShort;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const perTraderLong = tradersLong &gt; 0 ? Math.round(long / tradersLong) : 0;</span></p>
<p class="p1"><span class="s1">const perTraderShort = tradersShort &gt; 0 ? Math.round(short / tradersShort) : 0;</span></p>
<p class="p1"><span class="s1">document.getElementById('posPerTraderLong').textContent = perTraderLong.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('posPerTraderShort').textContent = perTraderShort.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('openInterest').textContent = oi ? oi.toLocaleString() : 'N/A';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">const recentNets = currentData.net.slice(-52);</span></p>
<p class="p1"><span class="s1">const high52 = Math.max(...recentNets);</span></p>
<p class="p1"><span class="s1">const low52 = Math.min(...recentNets);</span></p>
<p class="p1"><span class="s1">let week52RangeEl = document.getElementById('week52Range');</span></p>
<p class="p1"><span class="s1">if (!week52RangeEl) {</span></p>
<p class="p1"><span class="s1">const statsGrid = document.getElementById('statsGrid');</span></p>
<p class="p1"><span class="s1">const newCard = document.createElement('div');</span></p>
<p class="p1"><span class="s1">newCard.className = 'stat-card';</span></p>
<p class="p1"><span class="s1">newCard.innerHTML = `</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-label"&gt;52-Week Range&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-value" id="week52Range"&gt;--&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="stat-sub"&gt;Net position min/max&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">`;</span></p>
<p class="p1"><span class="s1">statsGrid.appendChild(newCard);</span></p>
<p class="p1"><span class="s1">week52RangeEl = document.getElementById('week52Range');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">week52RangeEl.textContent = `${low52.toLocaleString()} / ${high52.toLocaleString()}`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">document.getElementById('weeklyChange').textContent = (change &gt; 0 ? '+' : '') + change.toLocaleString();</span></p>
<p class="p1"><span class="s1">document.getElementById('weeklyChange').className = 'stat-value ' + (change &gt; 0 ? 'positive' : change &lt; 0 ? 'negative' : '');</span></p>
<p class="p1"><span class="s1">document.getElementById('weeklyChangePct').textContent = 'contracts';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">updateRangeBar(net, historicalExtremes.net?.min, historicalExtremes.net?.max, net &gt; 0);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function updateRangeBar(current, min, max, isLong) {</span></p>
<p class="p1"><span class="s1">const container = document.getElementById('netRangeBar');</span></p>
<p class="p1"><span class="s1">const labels = document.getElementById('netRangeLabels');</span></p>
<p class="p1"><span class="s1">if (!container || !labels || min === undefined || max === undefined || min === max) {</span></p>
<p class="p1"><span class="s1">if (container) container.style.display = 'none';</span></p>
<p class="p1"><span class="s1">if (labels) labels.style.display = 'none';</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">container.style.display = 'block';</span></p>
<p class="p1"><span class="s1">labels.style.display = 'flex';</span></p>
<p class="p1"><span class="s1">const bar = container.querySelector('.range-bar');</span></p>
<p class="p1"><span class="s1">const marker = container.querySelector('.range-marker');</span></p>
<p class="p1"><span class="s1">const minLabel = document.getElementById('netMinLabel');</span></p>
<p class="p1"><span class="s1">const maxLabel = document.getElementById('netMaxLabel');</span></p>
<p class="p1"><span class="s1">const range = max - min;</span></p>
<p class="p1"><span class="s1">const pct = ((current - min) / range) * 100;</span></p>
<p class="p1"><span class="s1">bar.className = 'range-bar ' + (isLong ? 'range-bar-net-long' : 'range-bar-net-short');</span></p>
<p class="p1"><span class="s1">marker.style.left = `${Math.max(0, Math.min(100, pct))}%`;</span></p>
<p class="p1"><span class="s1">minLabel.textContent = min.toLocaleString();</span></p>
<p class="p1"><span class="s1">maxLabel.textContent = max.toLocaleString();</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function downloadCSV() {</span></p>
<p class="p1"><span class="s1">if (!currentData) {</span></p>
<p class="p1"><span class="s1">showError('No data available to download. Please fetch data first.');</span></p>
<p class="p1"><span class="s1">return;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const commodity = document.getElementById('commoditySelect').value;</span></p>
<p class="p1"><span class="s1">const traderCategory = document.getElementById('traderCategory').value;</span></p>
<p class="p1"><span class="s1">let csv = 'Date,Long,Short,Net,Spread,Long % OI,Short % OI,Net % OI,Traders Long,Traders Short,Traders Total,Per Trader Long,Per Trader Short,Open Interest\n';</span></p>
<p class="p1"><span class="s1">for (let i = 0; i &lt; currentData.dates.length; i++) {</span></p>
<p class="p1"><span class="s1">const row = [</span></p>
<p class="p1"><span class="s1">currentData.dates[i],</span></p>
<p class="p1"><span class="s1">currentData.long[i],</span></p>
<p class="p1"><span class="s1">currentData.short[i],</span></p>
<p class="p1"><span class="s1">currentData.net[i],</span></p>
<p class="p1"><span class="s1">currentData.spread[i],</span></p>
<p class="p1"><span class="s1">currentData.longPct[i].toFixed(2),</span></p>
<p class="p1"><span class="s1">currentData.shortPct[i].toFixed(2),</span></p>
<p class="p1"><span class="s1">currentData.netPct[i].toFixed(2),</span></p>
<p class="p1"><span class="s1">currentData.tradersLong[i],</span></p>
<p class="p1"><span class="s1">currentData.tradersShort[i],</span></p>
<p class="p1"><span class="s1">currentData.tradersTotal[i],</span></p>
<p class="p1"><span class="s1">currentData.perTraderLong[i].toFixed(2),</span></p>
<p class="p1"><span class="s1">currentData.perTraderShort[i].toFixed(2),</span></p>
<p class="p1"><span class="s1">currentData.oi[i]</span></p>
<p class="p1"><span class="s1">];</span></p>
<p class="p1"><span class="s1">csv += row.join(',') + '\n';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });</span></p>
<p class="p1"><span class="s1">const link = document.createElement('a');</span></p>
<p class="p1"><span class="s1">const url = URL.createObjectURL(blob);</span></p>
<p class="p1"><span class="s1">const dateStr = new Date().toISOString().split('T')[0];</span></p>
<p class="p1"><span class="s1">const filename = `COT_${commodity.replace(/[^a-z0-9]/gi, '_')}_${traderCategory}_${dateStr}.csv`;</span></p>
<p class="p1"><span class="s1">link.setAttribute('href', url);</span></p>
<p class="p1"><span class="s1">link.setAttribute('download', filename);</span></p>
<p class="p1"><span class="s1">link.style.visibility = 'hidden';</span></p>
<p class="p1"><span class="s1">document.body.appendChild(link);</span></p>
<p class="p1"><span class="s1">link.click();</span></p>
<p class="p1"><span class="s1">document.body.removeChild(link);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function showLoading(show) {</span></p>
<p class="p1"><span class="s1">document.getElementById('loading').style.display = show ? 'block' : 'none';</span></p>
<p class="p1"><span class="s1">document.getElementById('fetchBtn').disabled = show;</span></p>
<p class="p1"><span class="s1">document.getElementById('summaryBtn').disabled = show;</span></p>
<p class="p1"><span class="s1">document.getElementById('downloadBtn').disabled = show;</span></p>
<p class="p1"><span class="s1">document.getElementById('commoditySelect').disabled = false;</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function showError(message) {</span></p>
<p class="p1"><span class="s1">const errorDiv = document.getElementById('error');</span></p>
<p class="p1"><span class="s1">errorDiv.textContent = message;</span></p>
<p class="p1"><span class="s1">errorDiv.style.display = 'block';</span></p>
<p class="p1"><span class="s1">setTimeout(() =&gt; errorDiv.style.display = 'none', 15000);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">function hideError() {</span></p>
<p class="p1"><span class="s1">document.getElementById('error').style.display = 'none';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
